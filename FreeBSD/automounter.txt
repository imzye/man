AUTOMOUNTER.CONF(5)       FreeBSD File Formats Manual      AUTOMOUNTER.CONF(5)

NAME
     automounter.conf – Define runtime parameters for automounter.

DESCRIPTION
     The automounter.conf file is a shell script that gets sourced into the
     automounter(8) script after the default settings have been defined. By
     overwriting variables these settings can be changed.

     No checks are performed on these settings, it is the responsibility of
     the system administrator to create a working configuration. For many
     systems the defaults ought to be fine and a configuration file is not
     required at all.

TOOL LOCATIONS
     The locations of amd(8), amq(8), rpcbind(8), rpcinfo(8) and logger(1) can
     be configured. In addition to pointing to different locations this can be
     used to call the tools with additional arguments.

AMD SETTINGS
     The following variables can be used to control the behaviour of amd(8).
     Please refer to that manual page for descriptions. The following will
     only list the defaults unless the variables are further processed.

     Unless noted otherwise after changing any of these settings automounter
     has to be restarted. Failing to do so can result in an inconsistent
     state.

     amd="/usr/sbin/amd"
             The location of the automounter daemon amd(8).

     amq="/usr/sbin/amq"
             The location of the automounter query tool amq(8).

     a="/var/run/automounter.amd"

     c=4

     w=2

     l="/var/run/automounter.amd.log"

     directory="/var/run/automounter.amd.mnt"

     map="/var/run/automounter.amd.map"
             This is the location of the dynamically created map.

     pidfile="/var/run/automounter.amd.pid"
             The PID file for amd(8).  Changing this will break the rc(8)
             script.

     static_map="/etc/amd.map"
             The map file that will be used to build the dynamic map from.

             For this setting to take effect an update call is sufficient.

RPC SETTINGS
     These settings only influence the startup of amd(8). The RPC daemon is a
     runtime dependency of amd(8).

     rpcbind="/usr/sbin/rpcbind"
             The location of the RPC daemon rpcbind(8).

     rpcinfo="/usr/bin/rpcinfo"
             The location of the RPC reporting tool rpcinfo(8).

RUNTIME SETTINGS
     blacklist_devs
             This variable can be used to exclude devices from automounting.
             The devices are Shell-Patterns separated by ','.

             The following example excludes ATA disks and CD-/DVD-drives:

                   blacklist_devs="ad*,acd*"

             Changing blacklist_devs takes effect after an update call.

     blacklist_nodes
             This allows blacklisting by mount names. Like blacklist_devs it
             is a ',' separated list of Shell-Patterns. The following example
             blacklists all ufs partitions:

                   blacklist_nodes="ufs/*"

             Changing blacklist_nodes takes effect after an update call.

     detect_glabel=1
             If set to 0 or any other value not 1, discovering file systems
             through the geom label class is deactivated.

             This setting takes effect with the next update call, excepting
             already mounted file systems.

     detect_iso9660=1
             If set to 0 or any other value not 1, assuming that devices
             matching the iso9660_devs pattern are optical disk drives is
             turned off.

             This setting takes effect with the next update call, excepting
             already mounted file systems.

     detect_probe=1
             If set to 0 or any other value not 1, discovering file systems
             through probing is deactivated.

             This setting takes effect with the next update call, excepting
             already mounted file systems.

     devfs="/dev"
             The location of the devfs(5).  This is required to know where to
             find the mount device nodes.

             This setting takes immediate effect.

     evil_fuse=0
             Setting this to 1 will activate a bug workaround for fuse based
             file systems such as ntfs-3g from the sysutils/fusefs-ntfs port.
             Fuse closes all opened files when an unmount is attempted. With
             automounter this happens every five seconds by default.

             The workaround uses fstat(1) to check whether files are opened on
             fuse based file systems and prevents the unmount command from
             being run if this is the case. The downside is that fstat is not
             able to see on which fuse file system the file is opened.  So all
             fuse file systems remain mounted until there are no more opened
             files on any of them.

             As long as only one fuse based file system is in use there are no
             downsides to using this workaround.

             The workaround takes immediate effect.

     iso9660=cd9660
             This is obligatory to mount optical discs.

             This setting takes immediate effect.

     iso9660_devs="acd*,cd*"
             This is a comma separated list of glob patterns. Devices matching
             one of the patterns are assumed to be optical disk drives.

             Changes to this setting take effect with the next update call.

     iso9660_options=ro
             This is more appropriate for optical devices than the default
             mount options.

             This setting takes immediate effect.

     linkdir="/media"
             The directory that will be populated with the links to amd(8)
             mounts. It might be good to change this to avoid clashes with
             hald(8) based mounting solutions.

             It is recommended to stop automounter before changing this
             setting, because a change would prevent automounter from cleaning
             up properly behind itself.

     lock="/var/run/automounter.lock"
             A lock file that is used to prevent clashes between several
             instances of automounter(8), e.g. when there are several USB
             events at once.

             This takes immediate effect.

     logger="/usr/bin/logger -st automounter"
             The logger(1) command, reports messages to syslogd(8).  This can
             be replaced with an arbitrary command that accepts messages as
             arguments and from stdin(4).

             Changes take immediate effect.

     mount_options=rw,noatime,noexec
             These are the default options given to mount when mounting a file
             system.

             This takes immediate effect.

     mountdir="/var/run/automounter.mnt"
             A directory where automounter(8) will create the mount points for
             amd.

             Like with linkdir it is required to stop automounter before
             changing mountdir to avoid an inconsistent state.

     nodes="/var/tmp/automounter.nodes"
             This file is used to remember which mounts are currently managed
             by automounter(8).

             It is required to stop automounter before changing nodes.

     oldnodes="/tmp/automounter.nodes.old"
             A temporary file that is used to find out weather any mounts
             should be cleaned up.

             A change of oldnodes takes immediate effect.

     probe="/tmp/automounter.probe"
             A directory used for mount attempts to probe file system types of
             unlabeled geom providers.

             Changing this takes immediate effect.

     probed="/tmp/automounter.probed"
             A temporary file used to prevent the probing of geom providers
             whose labels have been blacklisted.

             Changing this takes immediate effect.

     screen="/tmp/automounter.screen"
             A file with a list of devices present for the last update. Unless
             the file modification time is further in the past than the time
             specified by timeout, or the current device list differs, devd(8)
             issued update calls are discarded.

             The device discovery activities of automounter may cause new devd
             events. This mechanism effectively prevents race conditions.

             Changing this takes immediate effect.

     probe_types=ufs,msdosfs,iso9660,ntfs,ext2fs
             A comma separated list of file system types to automatically
             probe for.

             Changing probe_types takes effect with the next update call.

     timeout=10
             The time out for acquiring the lock. If the time out passes
             without gaining the lock the instance of automounter(8) is
             skipped.

             Changing the timeout takes immediate effect.

FILE SYSTEM SPECIFIC SETTINGS
     It is possible to influence the -t and -o parameters given to the mount
     command for each supported file system type.

     The parameter -t defaults to the identified file system type. For optical
     drives the file system type does not match the mount type, hence
     iso9660=cd9660 is set by default.  All mount types can be set similarly.
     The following example shows how to use ntfs-3g to mount ntfs file
     systems.

           ntfs=ntfs-3g

     The parameter -o defaults to mount_options, but it can be set
     individually for each file system type. The following example will mount
     msdosfs file systems with UTF-8 encoded file names:

           msdosfs_options=$mount_options,-L=en_GB.UTF-8

     Changing these settings takes immediate effect.

     Note that more recent versions of FreeBSD have the mountprog option,
     which makes the -t parameter obsolete in most cases. Read mount(8) for
     details.

GELI
     This section describes all settings related to geli(8) key polling and
     auto attaching. Automounter should be stopped before any of them are
     changed.

     New images and keys can be added any time. Images should not be removed
     while mounted.

     geli=0  By default all geli features are deactivated. To enable them this
             should be set to 1.

     geli_nodes="/var/run/automounter.geli.nodes"
             A file that is used to remember the device as which images were
             attached and the key that was used for attaching.

     geli_oldnodes="/tmp/automounter.geli.oldnodes"
             A temporary file that is used when removing stale attachments or
             adding new ones.

     geli_availablekeys="/var/run/automounter.geli.keys"
             A file for remembering the keys that are currently available.

     geli_images="/var/geli/images"
             The directory where images and device links are located.

     geli_keys=".geli/keys"
             The directory on managed file systems to poll for keys.

FILES
     /usr/local/etc/automounter.conf

     /usr/local/etc/automounter.conf.sample

SEE ALSO
     automounter(8), amd(8), amq(8), rpcbind(8), rpcinfo(8), mount(8),
     logger(1), syslogd(8), geli(8)

AUTHOR
     Dominic Fandrey ⟨kamikaze@bsdforen.de⟩

FreeBSD 14.1-RELEASE           2 September 2013           FreeBSD 14.1-RELEASE
