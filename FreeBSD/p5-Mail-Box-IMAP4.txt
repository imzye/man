Mail::Box::IMAP4(3)   User Contributed Perl Documentation  Mail::Box::IMAP4(3)


NAME
       Mail::Box::IMAP4 - handle IMAP4 folders as client

INHERITANCE
        Mail::Box::IMAP4
          is a Mail::Box::Net
          is a Mail::Box
          is a Mail::Reporter

        Mail::Box::IMAP4 is extended by
          Mail::Box::IMAP4s

SYNOPSIS
        my $url = 'imap4://user:passwd@host:port/INBOX';
        my $url = 'imap://user:passwd@host:port/INBOX';

        use Mail::Box::IMAP4;
        my $folder = Mail::Box::IMAP4->new(folder => $url, ...);

        use Mail::Box::Manager;
        my $mgr    = Mail::Box::Manager->new;
        my $folder = $msg->open($url, retry => 3, interval => 5);

DESCRIPTION
       Maintain a folder which has its messages stored on a remote server.
       The communication between the client application and the server is
       implemented using the IMAP4 protocol.  See also Mail::Server::IMAP4.

       This class uses Mail::Transport::IMAP4 to hide the transport of
       information, and focusses solely on the correct handling of messages
       within a IMAP4 folder.  More than one IMAP4 folder can be handled by
       one single IMAP4 connection.

       Extends "DESCRIPTION" in Mail::Box::Net.

OVERLOADED
       Extends "OVERLOADED" in Mail::Box::Net.

       overload: ""
           Inherited, see "OVERLOADED" in Mail::Box

       overload: @{}
           Inherited, see "OVERLOADED" in Mail::Box

       overload: cmp
           Inherited, see "OVERLOADED" in Mail::Box

METHODS
       Extends "METHODS" in Mail::Box::Net.

   Constructors
       Extends "Constructors" in Mail::Box::Net.

       Mail::Box::IMAP4->new(%options)
           The "new" can have many %options.  Not only the ones listed here
           below, but also all the %options for Mail::Transport::IMAP4::new()
           can be passed.

           The default depends on the value of new(cache_head).

           Without folder name, no folder is selected.  Only few methods are
           available now, for instance listSubFolders() to get the top-level
           folder names.  Usually, the folder named "INBOX" will be present.

            -Option           --Defined in     --Default
             access             Mail::Box        'r'
             body_delayed_type  Mail::Box        Mail::Message::Body::Delayed
             body_type          Mail::Box        Mail::Message::Body::Lines
             cache_body                          NO
             cache_head                          NO or DELAY
             cache_labels                        NO or DELAY
             coerce_options     Mail::Box        []
             create             Mail::Box        <false>
             extract            Mail::Box        10240
             field_type         Mail::Box        undef
             fix_headers        Mail::Box        <false>
             folder             Mail::Box        /
             folderdir          Mail::Box        <network location>
             head_delayed_type  Mail::Box        Mail::Message::Head::Delayed
             head_type          Mail::Box        Mail::Box::IMAP4::Head or Mail::Message::Head::Complete
             join_connection                     true
             keep_dups          Mail::Box        <false>
             lock_file          Mail::Box        undef
             lock_timeout       Mail::Box        1 hour
             lock_type          Mail::Box        'NONE'
             lock_wait          Mail::Box        10 seconds
             locker             Mail::Box        undef
             log                Mail::Reporter   'WARNINGS'
             manager            Mail::Box        undef
             message_type       Mail::Box        Mail::Box::IMAP4::Message
             multipart_type     Mail::Box        Mail::Message::Body::Multipart
             password           Mail::Box::Net   undef
             remove_when_empty  Mail::Box        <false>
             save_on_exit       Mail::Box        <true>
             server_name        Mail::Box::Net   undef
             server_port        Mail::Box::Net   143
             trace              Mail::Reporter   'WARNINGS'
             transporter                         Mail::Transport::IMAP4
             trusted            Mail::Box        <false>
             username           Mail::Box::Net   undef

           access => MODE
           body_delayed_type => CLASS
           body_type => CLASS|CODE
           cache_body => 'NO'|'YES'|'DELAY'
             Body objects are immutable, but may still cached or not.  In
             common case, the body of a message is requested via
             Mail::Message::body() or Mail::Message::decoded().  This returns
             a handle to a body object.  You may decide whether that body
             object can be reused or not.  "NO" means: retrieve the data each
             time again, "YES" will cache the body data, "DELAY" will send the
             whole message when the folder is closed.

                     [local cache]  [write]
              NO         no           no
              YES        yes          no
              DELAY      yes          yes

           cache_head => 'NO'|'PARTIAL'|'DELAY'
             For a read-only folder, "DELAY" is the default, otherwise "NO" is
             chosen.  The four configuration parameter have subtile
             consequences.  To start with a table:

                     [local cache]  [write]  [default head_type]
              NO         no           no     Mail::Box::IMAP4::Head
              PARTIAL    yes          no     Mail::Box::IMAP4::Head
              DELAY      yes          yes    Mail::Message::Head::Complete

             The default "head_type" is Mail::Box::IMAP4::Head, the default
             "cached_head_type" is Mail::Message::Head::Complete.

             Having a local cache means that a lookup for a field is first
             done in a local data-structure (which extends
             Mail::Message::Head::Partial), and only on the remote server if
             it was not found.  This is dangerous, because your locally cached
             data can be out-of-sync with the server.  However, it may give
             you a nice performance benefit.

             "DELAY" will always collect the whole header for you.  This is
             required when you want to look for Resent Groups (See
             Mail::Message::Head::ResentGroup) or other field order dependent
             header access.  A Mail::Message::Head::Delayed will be created
             first.

           cache_labels => 'NO'|'WRITE'|'DELAY'
             When labels from a message are received, these values can be
             kept. However, this imposes dangers where the server's internal
             label storage may get out of sync with your data.

             With "NO", no caching will take place (but the performance will
             be worse). With "WRITE", all label access will be cached, but
             written to the server as well.  Both "NO" and "WRITE" will update
             the labels on the served, even when the folder was opened read-
             only.  "DELAY" will not write the changed information to the
             server, but delay that till the moment that the folder is closed.
             It only works when the folder is opened read/write or write is
             enforced.

             The default is "DELAY" for folders which where opened read-only.
             This means that you still can force an update with close(write).
             For folders which are opened read-write, the default is the
             safeset setting, which is "NO".

           coerce_options => ARRAY
           create => BOOLEAN
           extract => INTEGER | CODE | METHOD | 'LAZY'|'ALWAYS'
           field_type => CLASS
           fix_headers => BOOLEAN
           folder => FOLDERNAME
           folderdir => DIRECTORY
           head_delayed_type => CLASS
           head_type => CLASS
           join_connection => BOOLEAN
             Within this Mail::Box::IMAP4 class is registered which
             transporters are already in use, i.e. which connections to the
             IMAP server are already in established.  When this option is set,
             multiple folder openings on the same server will try to reuse one
             connection.

           keep_dups => BOOLEAN
           lock_file => FILENAME
           lock_timeout => SECONDS
           lock_type => CLASS|STRING|ARRAY
           lock_wait => SECONDS
           locker => OBJECT
           log => LEVEL
           manager => MANAGER
           message_type => CLASS
           multipart_type => CLASS
           password => STRING
           remove_when_empty => BOOLEAN
           save_on_exit => BOOLEAN
           server_name => HOSTNAME
           server_port => INTEGER
           trace => LEVEL
           transporter => OBJECT|CLASS
             The name of the CLASS which will interface with the connection.
             When you implement your own extension to Mail::Transport::IMAP4,
             you can either specify a fully instantiated transporter OBJECT,
             or the name of your own CLASS.  When an OBJECT is given, most
             other options will be ignored.

           trusted => BOOLEAN
           username => STRING

           example:

            my $imap   = Mail::Box::IMAP4->new(username => 'myname',
               password => 'mypassword', server_name => 'imap.xs4all.nl');

            my $url    = 'imap4://user:password@imap.xs4all.nl';
            my $imap   = $mgr->open($url);

            my $client = Mail::IMAPClient->new(...);
            my $imap   = Mail::Box::IMAP4->new(imap_client => $client);

   The folder
       Extends "The folder" in Mail::Box::Net.

       $obj->addMessage($message, %options)
           Inherited, see "The folder" in Mail::Box

       $obj->addMessages(@messages)
           Inherited, see "The folder" in Mail::Box

       Mail::Box::IMAP4->appendMessages(%options)
           Inherited, see "The folder" in Mail::Box

       $obj->close(%options)
           Close the folder.  In the case of IMAP, more than one folder can
           use the same connection, therefore, closing a folder does not
           always close the connection to the server.  Only when no folder is
           using the connection anymore, a logout will be invoked by
           Mail::Transport::IMAP4::DESTROY()

            -Option      --Defined in     --Default
             force         Mail::Box        <false>
             save_deleted  Mail::Box        false
             write         Mail::Box        MODIFIED

           force => BOOLEAN
           save_deleted => BOOLEAN
           write => 'ALWAYS'|'NEVER'|'MODIFIED'
       $obj->copyTo($folder, %options)
           Inherited, see "The folder" in Mail::Box

       $obj->delete(%options)
           Inherited, see "The folder" in Mail::Box

       $obj->folderdir( [$directory] )
           Inherited, see "The folder" in Mail::Box

       $obj->name()
           Inherited, see "The folder" in Mail::Box

       $obj->organization()
           Inherited, see "The folder" in Mail::Box

       $obj->size()
           Inherited, see "The folder" in Mail::Box

       $obj->type()
           Inherited, see "The folder" in Mail::Box

       $obj->update(%options)
           Inherited, see "The folder" in Mail::Box

       $obj->url()
           Inherited, see "The folder" in Mail::Box

   Folder flags
       Extends "Folder flags" in Mail::Box::Net.

       $obj->access()
           Inherited, see "Folder flags" in Mail::Box

       $obj->isModified()
           Inherited, see "Folder flags" in Mail::Box

       $obj->modified( [BOOLEAN] )
           Inherited, see "Folder flags" in Mail::Box

       $obj->writable()
           Inherited, see "Folder flags" in Mail::Box

   The messages
       Extends "The messages" in Mail::Box::Net.

       $obj->current( [$number|$message|$message_id] )
           Inherited, see "The messages" in Mail::Box

       $obj->find($message_id)
           Inherited, see "The messages" in Mail::Box

       $obj->findFirstLabeled( $label, [BOOLEAN, [$msgs]] )
           Inherited, see "The messages" in Mail::Box

       $obj->message( $index, [$message] )
           Inherited, see "The messages" in Mail::Box

       $obj->messageId( $message_id, [$message] )
           Inherited, see "The messages" in Mail::Box

       $obj->messageIds()
           Inherited, see "The messages" in Mail::Box

       $obj->messages( <'ALL'|$range|'ACTIVE'|'DELETED'|$label|
       !$label|$filter> )
           Inherited, see "The messages" in Mail::Box

       $obj->nrMessages(%options)
           Inherited, see "The messages" in Mail::Box

       $obj->scanForMessages($message, $message_ids, $timespan, $window)
           Inherited, see "The messages" in Mail::Box

   Sub-folders
       Extends "Sub-folders" in Mail::Box::Net.

       $obj->listSubFolders(%options)
       Mail::Box::IMAP4->listSubFolders(%options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj->nameOfSubFolder( $subname, [$parentname] )
       Mail::Box::IMAP4->nameOfSubFolder( $subname, [$parentname] )
           Inherited, see "Sub-folders" in Mail::Box

       $obj->openRelatedFolder(%options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj->openSubFolder($subname, %options)
           Inherited, see "Sub-folders" in Mail::Box

       $obj->topFolderWithMessages()
       Mail::Box::IMAP4->topFolderWithMessages()
           Inherited, see "Sub-folders" in Mail::Box

   Internals
       Extends "Internals" in Mail::Box::Net.

       $obj->body( [$body] )
       $obj->coerce($message, %options)
           Inherited, see "Internals" in Mail::Box

       $obj->create($folder, %options)
       Mail::Box::IMAP4->create($folder, %options)
           Inherited, see "METHODS" in Mail::Box::Net

       $obj->createTransporter($class, %options)
           Create a transporter object (an instance of
           Mail::Transport::IMAP4), where $class defines the exact object
           type.  As %options, everything which is acceptable to a transporter
           initiation can be used (see Mail::Transport::IMAP4::new().

            -Option         --Default
             join_connection  true

           join_connection => BOOLEAN
             See new(join_connection).  When false, the connection will never
             be shared with other IMAP mail boxes.

       $obj->determineBodyType($message, $head)
           Inherited, see "Internals" in Mail::Box

       $obj->fetch( <$messages|$selection>, $info )
           Low-level data retreival about one or more messages via IMAP4 from
           the remote server. Some of this data may differ from the
           information which is stored in the message objects which are
           created by MailBox, so you should avoid the use of this method for
           your own purposes.  The IMAP implementation provides some wrappers
           around this, providing the correct behavior.

           An ARRAY of $messages may be specified or some message $selection,
           acceptable to Mail::Box::messages().  Examples of the latter are
           'ALL', 'DELETED', or "spam" (messages labelled to contain spam).

           The $info contains one or more attributes as defined by the IMAP
           protocol.  You have to read the full specs of the related RFCs to
           see these.

       Mail::Box::IMAP4->foundIn( [$foldername], %options )
           Inherited, see "Internals" in Mail::Box

       $obj->getHead($message)
           Read the header for the specified message from the remote server.
           "undef" is returned in case the message disappeared.

       $obj->getHeadAndBody($message)
           Read all data for the specified message from the remote server.
           Return head and body of the mesasge as list, or an empty list if
           the $message disappeared from the server.

       $obj->lineSeparator( [<STRING|'CR'|'LF'|'CRLF'>] )
           Inherited, see "Internals" in Mail::Box

       $obj->locker()
           Inherited, see "Internals" in Mail::Box

       $obj->read(%options)
           Inherited, see "Internals" in Mail::Box

       $obj->readMessages(%options)
           Inherited, see "Internals" in Mail::Box

       $obj->storeMessage($message)
           Inherited, see "Internals" in Mail::Box

       $obj->toBeThreaded($messages)
           Inherited, see "Internals" in Mail::Box

       $obj->toBeUnthreaded($messages)
           Inherited, see "Internals" in Mail::Box

       $obj->transporter( [$object] )
           Returns the object which is the interface to the IMAP4 protocol
           handler.  The IMAP4 handler has the current folder selected.  When
           an $object is specified, it is set to be the transporter from that
           moment on.  The $object must extend Mail::Transport::IMAP4.

       $obj->updateMessages(%options)
           Inherited, see "Internals" in Mail::Box

       $obj->write(%options)
           The IMAP protocol usually writes the data immediately to the remote
           server, because that's what the protocol wants.  However, some
           options to new() may delay that to boost performance.  This method
           will, when the folder is being closed, write that info after all.

            -Option      --Defined in     --Default
             force         Mail::Box        <false>
             save_deleted                   <false>

           force => BOOLEAN
           save_deleted => BOOLEAN
             You may be able to save the messages which are flagged for
             deletion now, but they will be removed anyway when the folder is
             closed.

       $obj->writeMessages(%options)
            -Option     --Defined in     --Default
             messages     Mail::Box        <required>
             transporter                   <required>

           messages => ARRAY
           transporter => OBJECT

   Other methods
       Extends "Other methods" in Mail::Box::Net.

       $obj->timespan2seconds($time)
       Mail::Box::IMAP4->timespan2seconds($time)
           Inherited, see "Other methods" in Mail::Box

   Error handling
       Extends "Error handling" in Mail::Box::Net.

       $obj->AUTOLOAD()
           Inherited, see "Error handling" in Mail::Reporter

       $obj->addReport($object)
           Inherited, see "Error handling" in Mail::Reporter

       $obj->defaultTrace( [$level]|[$loglevel, $tracelevel]|[$level,
       $callback] )
       Mail::Box::IMAP4->defaultTrace( [$level]|[$loglevel,
       $tracelevel]|[$level, $callback] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj->errors()
           Inherited, see "Error handling" in Mail::Reporter

       $obj->log( [$level, [$strings]] )
       Mail::Box::IMAP4->log( [$level, [$strings]] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj->logPriority($level)
       Mail::Box::IMAP4->logPriority($level)
           Inherited, see "Error handling" in Mail::Reporter

       $obj->logSettings()
           Inherited, see "Error handling" in Mail::Reporter

       $obj->notImplemented()
           Inherited, see "Error handling" in Mail::Reporter

       $obj->report( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj->reportAll( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj->trace( [$level] )
           Inherited, see "Error handling" in Mail::Reporter

       $obj->warnings()
           Inherited, see "Error handling" in Mail::Reporter

   Cleanup
       Extends "Cleanup" in Mail::Box::Net.

       $obj->DESTROY()
           Inherited, see "Cleanup" in Mail::Box

DETAILS
       Extends "DETAILS" in Mail::Box::Net.

DIAGNOSTICS
       Warning: Cannot find head back for $uidl in $folder.
           The header was read before, but now seems empty: the IMAP4 server
           does not produce the header lines anymore.

       Warning: Cannot read body for $uidl in $folder.
           The header of the message was retrieved from the IMAP4 server, but
           the body is not read, for an unknown reason.

       Error: Copying failed for one message.
           For some reason, for instance disc full, removed by external
           process, or read-protection, it is impossible to copy one of the
           messages.  Copying will proceed for the other messages.

       Error: Couldn't select IMAP4 folder $name
       Error: Destination folder $name is not writable.
           The folder where the messages are copied to is not opened with
           write access (see new(access)).  This has no relation with write
           permission to the folder which is controlled by your operating
           system.

       Warning: Different messages with id $msgid
           The message id is discovered more than once within the same folder,
           but the content of the message seems to be different.  This should
           not be possible: each message must be unique.

       Error: Folder $name not deleted: not writable.
           The folder must be opened with write access via new(access),
           otherwise removing it will be refused.  So, you may have write-
           access according to the operating system, but that will not
           automatically mean that this "delete" method permits you to.  The
           reverse remark is valid as well.

       Notice: Impossible to keep deleted messages in IMAP
           Some folder type have a 'deleted' flag which can be stored in the
           folder to be performed later.  The folder keeps that knowledge even
           when the folder is rewritten.  Well, IMAP4 cannot play that trick.

       Error: Invalid timespan '$timespan' specified.
           The string does not follow the strict rules of the time span syntax
           which is permitted as parameter.

       Warning: Message $uidl disappeared from $folder.
           Trying to get the specific message from the server, but it appears
           to be gone.

       Warning: Message $uidl disappeared from $folder.
           Trying to get the specific message from the server, but it appears
           to be gone.

       Warning: Message-id '$msgid' does not contain a domain.
           According to the RFCs, message-ids need to contain a unique random
           part, then an "@", and then a domain name.  This is made to avoid
           the creation of two messages with the same id.  The warning emerges
           when the "@" is missing from the string.

       Error: No IMAP4 transporter configured
       Error: Package $package does not implement $method.
           Fatal error: the specific package (or one of its superclasses) does
           not implement this method where it should. This message means that
           some other related classes do implement this method however the
           class at hand does not.  Probably you should investigate this and
           probably inform the author of the package.

       Error: Unable to create subfolder $name of $folder.
           The copy includes the subfolders, but for some reason it was not
           possible to copy one of these.  Copying will proceed for all other
           sub-folders.

SEE ALSO
       This module is part of Mail-Box-IMAP4 distribution version 3.009, built
       on April 18, 2025. Website: http://perl.overmeer.net/CPAN/

LICENSE
       Copyrights 2001-2025 by [Mark Overmeer]. For other contributors see
       ChangeLog.

       This program is free software; you can redistribute it and/or modify it
       under the same terms as Perl itself.  See http://dev.perl.org/licenses/

perl v5.40.2                      2025-04-18               Mail::Box::IMAP4(3)
