virt-builder(1)                                                                            Virtualization Support                                                                           virt-builder(1)

НАЗВА
       virt-builder — засіб швидкої побудови образів для віртуальної машини

КОРОТКИЙ ОПИС
        virt-builder версія-ОС
           [-o|--output ОБРАЗ ДИСКА] [--size РОЗМІР] [--format raw|qcow2]
           [--arch АРХІТЕКТУРА] [--attach ФАЙЛ ISO]

        virt-builder -l|--list [--long] [--list-format short|long|json]

        virt-builder --notes версія-ОС

        virt-builder --print-cache

        virt-builder --cache-all-templates

        virt-builder --delete-cache

        virt-builder --get-kernel ОБРАЗДИСКА
           [--format raw|qcow2] [--output КАТАЛОГВИВЕДЕННЯ]

ОПИС
       Virt-builder — інструмент для швидкого збирання нових віртуальних машин. За його допомогою ви зможете зібрати цілий спектр віртуальних машин для локального використання або використання у «хмарі».
       Зазвичай, для цього достатньо декількох хвилин.  Крім того, у virt-builder передбачено багато способів налаштовування зібраних віртуальних машин. Усі команди віддаються за допомогою командного
       рядка. Для роботи програми не потрібні права доступу адміністратора системи, тому збирання нових віртуальних машин просто автоматизувати або керувати ним за допомогою скриптів.

       Зауважте, що virt-builder не встановлює гостьові системи «з нуля». Програма використовує ретельного приготовані, підписані цифровими підписами шаблони операційних систем і налаштовує їх. Такий
       підхід використано, оскільки він є набагато швидшим за інші. Втім, якщо потрібно встановити систему «з нуля», ви можете скористатися virt-install(1) та oz-install(1).

       Найпростіше буде розпочати з прикладів з наступного розділу.

ПРИКЛАДИ
   Показ списку доступних віртуальних машин
        virt-builder --list

       покаже список доступних до встановлення операційних систем. Типово, доступний набір операційних систем із вільним поширенням. Ви також можете додати свою операційну систему (див. нижче).

       Після вибору гостьової системи зі списку може виникнути потреба у ознайомленні із нотатками щодо встановлення:

        virt-builder --notes fedora-27

   Побудова віртуальної машини
        virt-builder fedora-27

       збере образ Fedora 25 для тієї самої архітектури, що і virt-builder (отже виконання команди у системі архітектури i686 призведе до спроби збирання образу i686, якщо це можливо). Образ матиме
       типові налаштування (мінімальний розмір, без облікових записів користувачів, випадковий пароль root, лише базовий мінімальний набір встановлених програм тощо).

       Потреби у запуску цієї програми від імені root немає.

       Першого разу доведеться отримати шаблон мережею, а наступні операції може бути кешовано (див. "КЕШУВАННЯ").

       Назву файла результатів буде визначено на основі назви шаблона, отже для наведеного вище прикладу буде fedora-27.img.  Змінити назву файла результатів можна за допомогою параметра -o:

        virt-builder fedora-27 -o mydisk.img

       Ви також можете скористатися параметром -o для запису на наявні пристрої або логічні томи.

        virt-builder fedora-27 --format qcow2

       Те саме, що і вище, але виведені дані буде записано у форматі qcow2 до fedora-27.qcow2.

        virt-builder fedora-27 --size 20G

       Як і вище, але обсяг виведених даних дорівнюватиме 20 ГБ. Розмір гостьової операційної системи буде змінено так, наче її скопійовано до виведених даних (автоматично, за допомогою virt-resize(1)).

        virt-builder fedora-27 --arch i686

       Те саме, що і вище, але з використанням шаблона i686, якщо він доступний.

   Встановлення пароля root
        virt-builder fedora-27 --root-password file:/tmp/rootpw

       Створити образ Fedora 25. Пароль користувача root буде запозичено з файла /tmp/rootpw.

       Зауважте, що якщо ви не встановите --root-password, гостьовій системі буде надано випадковий пароль адміністратора root, який буде виведено до стандартного виведення.

       Крім того, ви можете створювати облікові записи користувачів. Див. "КОРИСТУВАЧІ І ПАРОЛІ" нижче.

   Встановити назву вузла
        virt-builder fedora-27 --hostname virt.example.com

       Встановити назву вузла "virt.example.com".

   Встановлення програмного забезпечення
       Встановлення пакунків зі звичайного (гостьового) сховища (наприклад, за допомогою dnf або apt):

        virt-builder fedora-27 --install "inkscape,@Xfce Desktop"

       (У Fedora "@" використовується для встановлення груп пакунків. У Debian вам доведеться встановлювати відповідний метапакунок.)

       Для оновлення встановлених пакунків до останньої версії виконайте такі дії:

        virt-builder debian-7 --update

   Налаштовування встановленої системи
       Передбачено багато параметрів, за допомогою яких ви можете налаштувати встановлення. Це зокрема параметр --run/--run-command, за допомогою якого можна виконати скрипт оболонки або команду під час
       створення образу диска і додати або змінити файли, які буде включено до образу диска. За допомогою параметра --firstboot/--firstboot-command можна додати скрипти або команди, які буде виконано під
       час першого завантаження гостьової системи. За допомогою параметра --edit можна редагувати файли, а параметра --upload — вивантажувати файли до образу.

       Приклад:

        cat <<'EOF' > /tmp/dnf-update.sh
        dnf -y --best update
        EOF

        virt-builder fedora-27 --firstboot /tmp/dnf-update.sh

       або просто:

        virt-builder fedora-27 --firstboot-command 'dnf -y --best update'

       у результаті команду dnf(8) "update" буде один раз виконано під час першого завантаження гостьової системи.

       або

        virt-builder fedora-27 \
          --edit '/etc/dnf/dnf.conf:
                    s/gpgcheck=1/gpgcheck=0/'

       буде змінено /etc/dnf/dnf.conf у образі диска (під час створення образу диска, задовго до завантаження).

       Ви можете поєднувати ці параметри і додавати декілька параметрів усіх типів.

ПАРАМЕТРИ
       --help
           Показати довідкове повідомлення.

       --arch АРХІТЕКТУРА
           Використовувати для образу-результату вказану архітектуру. Це означає, що мають бути початкові коди шаблона для вказаної архітектури.

           Див. також "АРХІТЕКТУРА".

       --attach ФАЙЛ_ISO
           Під час етапу налаштовування вказаний диск долучається до базової системи libguestfs. Цей диск використовується для отримання даних додаткових сховищ програмного забезпечення або інших даних
           для створення нетипової системи.

           Ймовірно, вам варто додати мітки для долучених дисків (або скористатися назвою тому ISO), щоб надалі монтувати диски за міткою у ваших скриптах запуску:

            mkdir /tmp/mount
            mount LABEL=EXTRA /tmp/mount

           Параметр --attach можна вказати декілька разів, а форматом може бути будь-який формат образу (не лише ISO).

           Див. також --run, "Встановлення пакунків зі стороннього сховища під час збирання", genisoimage(1), virt-make-fs(1).

       --attach-format ФОРМАТ
           Вказати формат диска для наступного параметра --attach. Значенням аргументу "ФОРМАТ" зазвичай є "raw" або "qcow2".  Для образів ISO скористайтеся варіантом "raw".

       --cache КАТАЛОГ
       --no-cache
           --cache КАТАЛОГ встановлює каталог зберігання і пошуку файлів кешованих шаблонів. Якщо значення не встановлено, типовим значенням буде $XDG_CACHE_HOME/virt-builder/ або
           $HOME/.cache/virt-builder/.

           --no-cache вимикає кешування шаблонів.

       --cache-all-templates
           Отримати усі шаблони до кешу і завершити роботу. Див. "КЕШУВАННЯ".

           Зауважте, що кешуються не усі дані. Можна вивантажити додаткові шаблони. Крім того, не кешуються пакунки (параметри --install, --update).

       --check-signature
       --no-check-signature
           Перевіряти чи не перевіряти цифровий підпис шаблону операційної системи. Типово, програма перевіряє підпис і завершує роботу, якщо підпис не збігається із еталонним. Обійти цю перевірку можна
           за допомогою параметра --no-check-signature.

           Див. також --fingerprint.

       --colors
       --colours
           Використовувати послідовності символів ANSI для розфарбовування повідомлень. Ці послідовності типово використовуються, якщо дані виводяться на термінал tty.  Якщо дані, виведені програмою,
           спрямовуються до файла, послідовності визначення кольорів ANSI буде вимкнено, якщо ви не додасте до команди цей параметр.

       --curl CURL
           Вказати альтернативний виконуваний файл curl(1). Ви також можете скористатися цим параметром для додавання параметрів curl, наприклад, щоб вимкнути перевірку сертифікатів https:

            virt-builder --curl "curl --insecure" [...]

       --delete-cache
           Вилучити кеш шаблонів. Див. "КЕШУВАННЯ".

       --no-delete-on-failure
           Не вилучати файл виведених даних, якщо під час збирання станеться помилка. Даними з цього файла можна скористатися для діагностування причин помилки. Див. "ДІАГНОСТИЧНІ ЗБІРКИ", щоб дізнатися
           більше про діагностику образів.

           Типовою є поведінка, коли файл результатів буде вилучено, якщо станеться помилка у virt-builder (або, наприклад, помилка у одному зі скриптів, які запускає ця програма).

       --fingerprint 'AAAA BBBB ...'
           Перевірка того, що покажчик та шаблони підписано ключем із вказаним відбитком (Відбитком, зазвичай, є доволі довгий рядок, що складається з 10 груп 4 шістнадцяткових цифр).

           Ви можете скористатися цим параметром декілька разів. Якщо у вас декілька адрес початкового коду, у вас або не буде відбитка, або буде один відбиток або буде декілька відбитків. Якщо відбитків
           декілька, вам слід вказати для кожного адресу початкового коду.

       --format qcow2
       --format raw
           Для звичайних процедур збирання визначає формат виведення даних. Типовим значенням є raw.

           З --get-kernel визначає формат вхідних даних.

           Для створення файла qcow2 у застарілому стилі (для сумісності з RHEL 6 або дуже старим qemu < 1.1) після виконання програми virt-builder скористайтеся такою командою:

            qemu-img amend -f qcow2 -o compat=0.10 output.qcow2

       --get-kernel ОБРАЗ
           За допомогою цього параметра можна видобути ядро і initramfs з раніше зібраного образу диска із назвою "ОБРАЗ" (фактично, це працює для будь-якого образу диска віртуальної машини, не лише для
           образів, які зібрано за допомогою virt-builder).

           Зауважте, що цей метод є застарілим: для виконання цього завдання є окрема програма, virt-get-kernel(1), у якій передбачено більше варіантів видобування файлів.

           Ядро і initramfs буде записано до поточного каталогу, якщо ви не вкажете додатково назву каталогу результатів за допомогою параметра --output "каталог результатівr".

           Формат образу диска буде визначено автоматично, якщо ви не вкажете його за допомогою параметра --format.

           Якщо у гостьовій системі декілька ядер, буде вибрано ядро із найбільшим номером. Щоб видобути із образу диска ядро з певним номером версії, скористайтеся guestfish(1). Щоб видобути із
           гостьової системи увесь вміст каталогу /boot, скористайтеся virt-copy-out(1).

       --gpg GPG
           Вказати альтернативний виконуваний файл gpg(1) (GNU Privacy Guard). Типово, virt-builder шукає "gpg2" або "gpg" у каталогах, вказаних за допомогою змінної $PATH.

           Ви можете скористатися цим параметром для додавання параметрів до основної програми gpg, наприклад, для визначення альтернативного домашнього каталогу:

            virt-builder --gpg "gpg --homedir /tmp" [...]

       -l [версія-ОС]
       --list [версія-ОС]
       --list --list-format формат [версія ОС]
       --list --long [версія ОС]
           Вивести усі доступні шаблони, якщо не вказано гостьової системи, або вивести шаблони лише для вказаної гостьової системи.

           Ви можете вибрати формат виведення за допомогою параметра --list-format для шаблонів списку:

           short
               Типовий формат: виводиться лише ідентифікатор шаблона і, поряд з ним, його короткий опис.

           long
               Виводить тестовий список із даними щодо доступних джерел і список даних щодо доступних шаблонів після нього.

           json
               Вивести об’єкт JSON із подробицями щодо доступних джерел та подробиці щодо доступних шаблонів.

               Ключ "version" у основному об'єкті визначає «версію сумісності», його значення слід збільшувати кожного разу, коли результат використання JSON ставатиме несумісним із попередніми версіями
               (наприклад, через зміну структури або прибирання основних ключів).

           --long — скорочення для формату "long".

           Див також: --source, --notes, "ДЖЕРЕЛА ШАБЛОНІВ".

       --machine-readable
       --machine-readable=формат
           За допомогою цього параметра можна зробити виведені дані придатнішими для обробки комп'ютером, якщо для цієї обробки використовуються інші програми. Див. "ПРИДАТНЕ ДО ЧИТАННЯ КОМП'ЮТЕРОМ
           ВИВЕДЕННЯ" нижче.

       -m МБ
       --memsize МБ
           Зміна обсягу пам'яті, наданого скриптам --run. Збільште це значення, якщо виявиться, що для використання скриптів --run або параметра --install не вистачає пам'яті.

           Типові значення можна визначити за допомогою такої команди:

            guestfish get-memsize

       --network
       --no-network
           Увімкнути чи вимкнути доступ до мережі для гостьової системи під час встановлення.

           Типово увімкнено. Скористайтеся параметром --no-network, щоб вимкнути доступ.

           У мережі працюватимуть лише вихідні з'єднання, а також буде декілька інших незначних обмежень. Див. "МЕРЕЖА" in virt-rescue(1).

           Якщо ви скористаєтеся параметром --no-network, тоді інші параметри, зокрема --install, не працюватимуть.

           Це не вплине на доступність мережі для гостьової системи після її завантаження, оскільки така доступність керується вашим гіпервізором або хмарним середовищем і не має нічого спільного з
           virt-builder.

           Загалом кажучи, вам не варто використовувати --no-network. Але ось декілька випадків, коли у вас може виникнути потреба у використанні цього параметра:

           1.  У модулі обробки libguestfs, яким ви користуєтеся, не передбачено підтримки мережі.  (Див. "МОДУЛЬ" in guestfs(3)).

           2.  Усе програмне забезпечення, яке ви маєте намір встановити, походить з долученого образу ISO, отже потреби у мережі немає.

           3.  Ви не хочете, щоб ненадійний код із гостьової системи намагався отримати доступ до мережевого з'єднання вашої основної системи під час роботи virt-builder. Таке, зокрема, може трапитися,
               якщо ви не довіряєте джерелу шаблонів операційних систем.  (Див. "БЕЗПЕКА" нижче).

           4.  Ви не хочете користуватися мережею основної системи (наприклад, через захищеність або обмеженість середовища у ній).

       --no-sync
           Не синхронізувати файл виведення під час завершення роботи.

           Virt-builder виконує синхронізацію "fsync" файла результатів або образу диска, якщо такий існує.

           Причина полягає у тому, що типовим режимом кешування у qemu та KVM є "none" або "directsync", і у обох цих режимах не використовується кеш сторінок основної системи. Тому ці режими не
           працюватимуть належним чином, якщо ви негайно запустите гостьову систему після запуску virt-builder — гостьова система просто не побачить файл результатів повністю . (Зауважте, що вам не варто
           користуватися обома цими режимами кешування — вони непрацездатні на базовому рівні з цієї та інших причин.)

           Якщо ви не використовуєте ці помилкові режими кешування, ви можете скористатися параметром --no-sync, щоб усунути непотрібну синхронізацію і значно пришвидшити роботу програми.

       --notes версія-ОС
           Показує список нотаток, пов’язаних із гостьовою системою, потім завершує роботу (встановлення не виконується).

       -o назва_файла
       --output назва_файла
           Записати виведені дані до файла назва_файла. Якщо цей параметр не буде вказано, назву файла для виведення даних буде створено на основі рядка "версія-ос" із додаванням суфікса ".img" (для
           формату без обробки) або ".qcow2" (для формату qcow2).

           Зауважте, що назвою файла виведення результатів може бути пристрій, розділ або логічний том.

           Якщо використовується з --get-kernel, цей параметр задає каталог виведення даних.

       --print-cache
           Вивести інформацію щодо кешу шаблонів. Див. "КЕШУВАННЯ".

       -q
       --quiet
           Не виводити звичайних повідомлень щодо поступу.

       --size РОЗМІР
           Вибір розміру диска-результату, де розмір можна вказати за допомогою типових записів, зокрема "32G" (32 гігабайти) тощо.

           Virt-builder змінить розміри файлових систем у образі диска автоматично.

           Якщо розмір не задано, можлива реалізація двох сценаріїв. Якщо дані виводяться до файла, його розмір буде таким самим, як у шаблона. Якщо дані виводяться на пристрій, розділ тощо, буде
           використано розмір відповідного пристрою.

           Щоб вказати розмір у байтах, додайте до числа малу літеру b, наприклад "--size 10737418240b".

       --smp N
           Увімкнути N ≥ 2 віртуальних процесорів для використання у скриптах --run.

       --source АДРЕСА
           Встановити адресу початкових даних для пошуку покажчиків.

           Цей параметр можна вказати декілька разів, щоб визначити декілька джерел.

           Див. також "ДЖЕРЕЛА ШАБЛОНІВ" нижче.

           Зауважте, що не варто вказувати для --source джерела, яким ви не довіряєте (якщо їх не підписано кимось, кому ви довіряєте). Див. також параметр --no-network.

       --no-warn-if-partition
           Не видавати попередження, якщо пристроєм виведення даних є розділ. Це попередження надає змогу уникнути типової помилки користувача під час записування на флеш-накопичувач USB або зовнішній
           диск — запису на розділ, коли слід виконувати перезапис усього пристрою (--output /dev/sdX), а не розділу на ньому (--output /dev/sdX1). Скористайтеся цим параметром, щоб придушити відповідне
           попередження.

       -v
       --verbose
           Увімкнути діагностичні повідомлення і/або режим докладних повідомлень.

           Коли повідомлятимете про вади, скористайтеся цим параметром і долучіть усі виведені дані до звіту щодо вади.

       -V
       --version
           Показати дані щодо версії і завершити роботу.

       --wrap
           Wrap error, warning, and informative messages.  This is the default when the output is a tty.  If the output of the program is redirected to a file, wrapping is disabled unless you use this
           option.

       -x  Увімкнути трасування викликів програмного інтерфейсу libguestfs.

   Параметри налаштовування
       --append-line ФАЙЛ:РЯДОК
           Дописати один рядок тексту до файла "ФАЙЛ". Якщо файл ще не завершується порожнім рядком, такий рядок буде додано перед дописаним. Крім того, автоматично буде дописано символ нового рядка
           наприкінці рядка "РЯДОК".

           Наприклад, (припускаємо, що у командній оболонці використовуються звичайні лапки) така команда:

            --append-line '/etc/hosts:10.0.0.1 foo'

           додасть "10.0.0.1 foo⏎" або "⏎10.0.0.1 foo⏎" до файла; останній запис буде додано, лише якщо наявний файл ще не закінчується символом нового рядка.

           "⏎" позначає символ нового рядка, конкретне значення якого визначається за наявним вмістом файла, отже, команда обробляє файли однаково правильно для варіантів із завершеннями рядка у форматах
           Unix і Windows. Це працює і для порожніх і ще не створених файлів.

           Щоб додати декілька рядків, скористайтеся тим самим параметром декілька разів:

            --append-line '/etc/hosts:10.0.0.1 foo'
            --append-line '/etc/hosts:10.0.0.2 bar'

           Щоб додати порожній рядок перед дописаним рядком, скористайтеся такою конструкцією:

            --append-line '/etc/hosts:'
            --append-line '/etc/hosts:10.0.0.1 foo'

       --chmod ПРАВА_ДОСТУПУ:ФАЙЛ
           Змінити права доступу до файла "ФАЙЛ" на "ПРАВА_ДОСТУПУ".

           Зауваження: типово "ПРАВА_ДОСТУПУ" записуються у десятковому форматі, якщо ви не додасте початковий 0 , щоб вказати вісімкове число, тобто скористаєтеся 0700, а не 700.

       --chown UID:GID:PATH
           Change the owner user and group ID of a file or directory in the guest. Note:

           •   Only numeric UIDs and GIDs will work, and these may not be the same inside the guest as on the host.

           •   This will not work with Windows guests.

           Приклад:

            virt-customize --chown '0:0:/var/log/audit.log'

           See also: --upload.

       --commands-from-file НАЗВА_ФАЙЛА
           Прочитати команди налаштовування з файла, по одній (разом із аргументами) на рядок.

           Кожен рядок містить команду налаштовування та її аргументи, наприклад:

            delete /якийсь/файл
            install якийсь_пакунок
            password якийсь-користувач:password:його-новий-пароль

           Порожні рядки ігноруються, а рядки, що починаються з "#", є коментарями і також ігноруються. Крім того, аргументи можна розділити на декілька рядків додаванням "\" (символу продовження)
           наприкінці рядка. Приклад:

            edit /якийсь/файл:\
              s/^OPT=.*/OPT=ok/

           Команди обробляються у тому самому порядку, у якому їх вказано у файлі, так, наче їх вказано як --delete /якийсь/файл у рядку команди.

       --copy ДЖЕРЕЛО:ПРИЗНАЧЕННЯ
           Копіювати файли або каталоги рекурсивно у межах гостьової системи.

           Не можна використовувати символи-замінники.

       --copy-in ЛОКАЛЬНИЙ_ШЛЯХ:ВІДДАЛЕНИЙ_КАТАЛОГ
           Скопіювати локальні файли або каталоги рекурсивно до образу диска, розташувавши його у каталозі "ВІДДАЛЕНИЙ_КАТАЛОГ" (який має існувати).

           Не можна використовувати символи-замінники.

       --delete ШЛЯХ
           Вилучити файл з гостьової системи. Або вилучити каталог (і увесь його вміст, рекурсивно).

           Ви можете скористатися символами-замінниками у вказаному шляху. Не забудьте екранувати символи-замінники у командній оболонці основної системи, якщо це потрібно. Приклад:

            virt-customize --delete '/var/log/*.log'.

           Див. також --upload, --scrub.

       --edit ФАЙЛ:ВИРАЗ
           Редагувати "ФАЙЛ" з використанням виразу Perl "ВИРАЗ".

           Слід подбати про належне розставлення лапок у виразі, щоб запобігти його зміні у командній оболонці.

           Зауважте, що цим параметром можна буде скористатися, лише якщо встановлено Perl 5.

           Див. "NON-INTERACTIVE EDITING" in virt-edit(1).

       --firstboot СКРИПТ
           Встановити "СКРИПТ" у гостьовій системі і запустити його під час першого завантаження гостьової системи (від імені root, у останній частині процесу завантаження).

           До скрипту, після встановлення до гостьової системи, буде автоматично застосовано команду chmod +x.

           Альтернативна версія --firstboot-command є такою самою, але зручно включає команду у однорядковому скрипті.

           Можна вказати декілька параметрів --firstboot. Їх буде виконано у тому самому порядку, у якому їх вказано у рядку команди.

           Будь ласка, зверніться до розділу "СКРИПТИ ПЕРШОГО ЗАВАНТАЖЕННЯ", щоб ознайомитися із відомостями щодо скриптів першого завантаження і проблемами у їх використанні.

           Див. також --run.

       --firstboot-command 'КОМАНДА+ПАРАМЕТРИ'
           Виконати команду (разом із аргументами) у гостьовій системі під час першого завантаження гостьової системи (від імені root, у останній частині процесу завантаження).

           Можна вказати декілька параметрів --firstboot. Їх буде виконано у тому самому порядку, у якому їх вказано у рядку команди.

           Будь ласка, зверніться до розділу "СКРИПТИ ПЕРШОГО ЗАВАНТАЖЕННЯ", щоб ознайомитися із відомостями щодо скриптів першого завантаження і проблемами у їх використанні.

           Див. також --run.

       --firstboot-install ПАКУНОК,ПАКУНОК..
           Встановити іменовані пакунки (список значень, відокремлених комами). Ці пакунки буде встановлено під час першого завантаження гостьової системи за допомогою програми для керування пакунків
           гостьової системи (наприклад, apt, yum тощо) і з'єднання із мережею гостьової системи.

           Огляд різних способів встановлення пакунків наведено у розділі "ВСТАНОВЛЕННЯ ПАКУНКІВ".

       --hostname НАЗВА_ВУЗЛА
           Встановити як назву вузла гостьової системи значення "НАЗВА_ВУЗЛА". Якщо потрібно, можете скористатися форматом із крапкою, «назва_вузла.назва_домену» (FQDN).

       --inject-qemu-ga METHOD
           Inject the QEMU Guest Agent into a Windows guest.  The guest agent communicates with qemu through a socket in order to provide enhanced features (see qemu-ga(8)).  This operation also injects
           a firstboot script so that the Guest Agent is installed when the guest boots.

           The parameter is the same as used by the --inject-virtio-win operation.

           Note that to do a full conversion of a Windows guest from a foreign hypervisor like VMware (which involves many other operations)  you should use the virt-v2v(1) tool instead of this.

       --inject-virtio-win METHOD
           Inject virtio-win drivers into a Windows guest.  These drivers add virtio accelerated drivers suitable when running on top of a hypervisor that supports virtio (such as qemu/KVM).  The
           operation also adjusts the Windows Registry so that the drivers are installed when the guest boots.

           The parameter can be one of:

           ISO The path to the ISO image containing the virtio-win drivers (eg. /usr/share/virtio-win/virtio-win.iso).

           DIR The directory containing the unpacked virtio-win drivers (eg. /usr/share/virtio-win).

           "osinfo"
               The literal string "osinfo" means to use the libosinfo database to locate the drivers.  (See osinfo-query(1).

           Note that to do a full conversion of a Windows guest from a foreign hypervisor like VMware (which involves many other operations)  you should use the virt-v2v(1) tool instead of this.

       --install ПАКУНОК,ПАКУНОК..
           Встановити іменовані пакунки (список значень, відокремлених комами). Ці пакунки буде встановлено під час збирання образу за допомогою програми для керування пакунків гостьової системи
           (наприклад, apt, yum тощо) і з'єднання із мережею основної системи.

           Огляд різних способів встановлення пакунків наведено у розділі "ВСТАНОВЛЕННЯ ПАКУНКІВ".

           Див. також --update, --uninstall.

       --link ПРИЗНАЧЕННЯ:ПОСИЛАННЯ[:ПОСИЛАННЯ..]
           Створити символічне посилання або декілька посилань у гостьовій системі так, щоб вони з "ПОСИЛАННЯ" вказували на "ПРИЗНАЧЕННЯ".

       --mkdir КАТАЛОГ
           Створити каталог у гостьовій системі.

           Використовується "mkdir -p", отже буде створено усі проміжні каталоги. Також команда працює, якщо каталог вже існує.

       --move ДЖЕРЕЛО:ПРИЗНАЧЕННЯ
           Пересунути файли або каталоги у межах гостьової системи.

           Не можна використовувати символи-замінники.

       --no-logfile
           Витерти "builder.log" (файл журналу із командами збирання) з образу після завершення збирання. Якщо ви не хочете явним чином показувати, як було зібрано образ, скористайтеся цим параметром.

           Див. також "LOG FILE".

       --no-selinux-relabel
           Do not attempt to correct the SELinux labels of files in the guest.

           In such guests that support SELinux, customization automatically relabels files so that they have the correct SELinux label.  (The relabeling is performed immediately, but if the operation
           fails, customization will instead touch /.autorelabel on the image to schedule a relabel operation for the next time the image boots.)  This option disables the automatic relabeling.

           The option is a no-op for guests that do not support SELinux.

       --password КОРИСТУВАЧ:ВАРІАНТ
           Встановити пароль для користувача "КОРИСТУВАЧ". (Зауважте, що за допомогою цього параметра не можна створювати облікові записи користувачів.)

           Формат поля "ВАРІАНТ" та способи налаштовування облікових записів користувачів описано у розділі "КОРИСТУВАЧІ І ПАРОЛІ".

       --password-crypto md5|sha256|sha512
           Якщо змінюється чи встановлюється пароль для гостьової системи, за допомогою цього параметра можна встановити шифрування для цього пароля у значення "md5", "sha256" або "sha512".

           Для використання значень "sha256" та "sha512" має бути встановлено glibc ≥ 2.7 (перевірте у crypt(3) всередині гостьової системи).

           "md5" працюватиме з відносно давніми гостьовими системами Linux (наприкладRHEL 3), але є незахищеним щодо новітніх способів атак.

           Типовим способом шифрування є "sha512". Він використовується, якщо libguestfs вдасться виявити у гостьовій системі підтримку SHA-512. Якщо такої підтримки не буде виявлено,
           використовуватиметься "md5". За допомогою цього параметра ви можете перевизначити автоматично визначений libguestfs спосіб шифрування.

           Зауважте, що це не змінить типового шифрування, яке використовується гостьовою системою, коли ви створюєте у ній нові облікові записи користувачів. Якщо ви хочете змінити це шифрування, вам
           слід скористатися параметром --edit для внесення змін до "/etc/sysconfig/authconfig" (Fedora, RHEL) або "/etc/pam.d/common-password" (Debian, Ubuntu).

       --root-password ВАРІАНТ
           Встановити пароль користувача root.

           Формат поля "ВАРІАНТ" та способи налаштовування облікових записів користувачів описано у розділі "КОРИСТУВАЧІ І ПАРОЛІ".

           Зауваження: якщо у virt-builder ви не встановите --root-password, для гостьової системи буде використано випадковий пароль root.

       --run СКРИПТ
           Виконати скрипт оболонки (або будь-яку програму), яка називається "СКРИПТ" у образі диска. Скрипт буде запущено у віртуалізованому режимі у малій допоміжній системі, у пісочниці гостьової
           файлової системи.

           Для скрипту буде автоматично використано команду chmod +x.

           Якщо у libguestfs передбачено підтримку цього, буде доступним обмежене мережеве з'єднання, але лише для вихідних з'єднань. Ви також можете долучати диски з даними (наприклад, файли ISO), як ще
           один спосіб надання даних (наприклад, пакунків із програмним забезпеченням) для скрипту без потреби у з'єднанні із мережею (--attach). Також ви можете вивантажувати файли з даними (--upload).

           Можна вказати декілька параметрів --run. Їх буде виконано у тому самому порядку, у якому їх вказано у рядку команди.

           Див. також --firstboot, --attach, --upload.

       --run-command 'КОМАНДА+ПАРАМЕТРИ'
           Виконати команду із аргументами у образі диска. Команду буде виконано у віртуалізованому режимі у малій допоміжній системі, у пісочниці гостьової файлової системи.

           Якщо у libguestfs передбачено підтримку цього, буде доступним обмежене мережеве з'єднання, але лише для вихідних з'єднань. Ви також можете долучати диски з даними (наприклад, файли ISO), як ще
           один спосіб надання даних (наприклад, пакунків із програмним забезпеченням) для скрипту без потреби у з'єднанні із мережею (--attach). Також ви можете вивантажувати файли з даними (--upload).

           Можна вказати декілька параметрів --run-command. Їх буде виконано у тому самому порядку, у якому їх вказано у рядку команди.

           Див. також --firstboot, --attach, --upload.

       --scrub ФАЙЛ
           Витерти файл з гостьової системи. Подібне до --delete, окрім того, що:

           •   Витирає дані так, що їх не можна буде відновити з гостьової системи.

           •   Не може вилучати каталоги, лише звичайні файли.

       --selinux-relabel
           This is a compatibility option that does nothing.

       --sm-attach ВАРІАНТ
           Долучити систему до буфера передплати за допомогою "subscription-manager".

           Формат поля "ВАРІАНТ" описано у розділі "SUBSCRIPTION-MANAGER".

       --sm-credentials ВАРІАНТ
           Встановити реєстраційні дані для "subscription-manager".

           Формат поля "ВАРІАНТ" описано у розділі "SUBSCRIPTION-MANAGER".

       --sm-register
           Зареєструвати гостьову систему за допомогою "subscription-manager".

           Потребує встановлення реєстраційних даних за допомогою --sm-credentials.

       --sm-remove
           Вилучити усі передплати з гостьової системи за допомогою "subscription-manager".

       --sm-unregister
           Зняти гостьову систему з реєстрації за допомогою "subscription-manager".

       --ssh-inject КОРИСТУВАЧ[:ВАРІАНТ]
           Вставити ключ ssh так, щоб вказаний "КОРИСТУВАЧ" зміг увійти до системи з використанням ssh без потреби у визначенні пароля. Запис користувача "КОРИСТУВАЧ" має вже існувати у гостьовій
           системі.

           Формат поля "ВАРІАНТ" описано у розділі "КЛЮЧІ SSH".

           Ви можете додати декілька параметрів --ssh-inject для різних користувачів, а також для додавання декількох ключів для кожного з користувачів.

       --tar-in TARFILE:REMOTEDIR
           Copy local files or directories from a local tar file called "TARFILE" into the disk image, placing them in the directory "REMOTEDIR" (which must exist).  Note that the tar file must be
           uncompressed (.tar.gz files will not work here)

       --timezone ЧАСОВИЙ_ПОЯС
           Встановити типовий часовий пояс гостьової системи у значення "ЧАСОВИЙ_ПОЯС". Скористайтеся рядком місця у форматі "Europe/London"

       --touch ФАЙЛ
           Ця команда виконує подібну до touch(1) дію над файлом "ФАЙЛ".

       --truncate ФАЙЛ
           Ця команда обрізає файл "ФАЙЛ" до нульової довжини. Для її успішного виконання файл має існувати.

       --truncate-recursive ШЛЯХ
           Ця команда рекурсивно обрізає усі файли у каталозі "ШЛЯХ" до нульової довжини.

       --uninstall ПАКУНОК,ПАКУНОК..
           Вилучити іменовані пакунки (список значень, відокремлених комами). Ці пакунки буде вилучено під час збирання образу за допомогою програми для керування пакунків гостьової системи (наприклад,
           apt, yum тощо). З метою виконання запиту також може бути вилучено пакунки, залежні від вилучених пакунків.

           Див. також --install, --update.

       --update
           Виконує еквівалент "yum update", "apt-get upgrade" або якоїсь іншої команди, яка потрібна для оновлення пакунків, які вже встановлено у шаблоні, до найсвіжіших версій.

           Див. також --install, --uninstall.

       --upload ФАЙЛ:ПРИЗНАЧЕННЯ
           Вивантажити локальний файл "ФАЙЛ" до призначення "ПРИЗНАЧЕННЯ" на образі диска. Буде збережено власника і права доступу, отже вам слід вказати такі значення для цих параметрів, які мають бути
           на остаточному образі диска.

           Значенням параметра "ПРИЗНАЧЕННЯ" може бути назва остаточного файла. Цим можна скористатися для перейменовування файла під час вивантаження.

           Якщо значенням параметра "ПРИЗНАЧЕННЯ" є назва каталогу (який вже має існувати у гостьовій системі), файл буде вивантажено до вказаного каталогу, назву файла з локальної файлової системи буде
           збережено.

           Див. також --mkdir, --delete, --scrub.

       --write ФАЙЛ:ДАНІ
           Записати "ДАНІ" до файла "ФАЙЛ".

ДОВІДНИК
   ВСТАНОВЛЕННЯ ПАКУНКІВ
       Існує декілька підходів до встановлення пакунків або програм у гостьовій системі, використання кожного з яких має власні переваги і недоліки.

       Встановлення пакунків під час збирання

       Якщо гостьова операційна система є подібною до основної операційної системи (наприклад, обидві є операційними системами Linux), і у libguestfs передбачено підтримку з'єднань мережею, ви можете
       скористатися параметром --install для встановлення пакунків у такий спосіб:

        virt-builder fedora-27 --install inkscape

       Тут використано засіб керування пакунками гостьової системи і з'єднання із мережею основної системи.

       Оновлення пакунків під час збирання

       Щоб оновити встановлений набір пакунків у шаблоні під час збирання, віддайте таку команду:

        virt-builder fedora-27 --update

       У більшості шаблонів, які постачаються разом із virt-builder, передбачено дуже вузький набір пакунків (відомий як «JEOS» або «Just Enough Operating System» («Достатньо для того, щоб бути
       операційною системою»), які є актуальними на час створення шаблону, але можу виявитися застарілими на час, коли ви встановлюватимете операційну систему з шаблона. За допомогою цього параметра
       можна оновити пакунки з шаблона.

       Встановлення пакунків під час першого завантаження

       Іншим варіантом є встановлення пакунків під час першого завантаження гостьової системи:

        virt-builder fedora-27 --firstboot-install inkscape

       Тут використано засіб керування пакунками гостьової системи і з'єднання із мережею гостьової системи.

       Недоліком використання цього підходу є те, що гостьова система завантажуватиметься вперше набагато довше, а також те, що ви не зможете нічого зробити, якщо під час встановлення пакунків станеться
       помилка (наприклад, через проблеми із мережею гостьова система не зможе встановити зв'язок зі сховищем пакунків).

       Встановлення пакунків зі стороннього сховища під час збирання

       Якщо програмного забезпечення, яке ви хочете встановити, немає у основному сховищі пакунків гостьової системи, ви можете додати стороннє сховище. Зазвичай, таке сховище є файлом образу ISO
       (образом компакт-диска), у якому містяться дані додаткових пакунків.

       Ви можете створити образ диска за допомогою genisoimage(1) або virt-make-fs(1). Для genisoimage скористайтеся такою командою:

        genisoimage -o extra-packages.iso -R -J -V EXTRA cdcontents/

       Створіть скрипт, який монтує ISO і налаштовує сховище. Для dnf створіть /tmp/install.sh з таким вмістом:

        mkdir /tmp/mount
        mount LABEL=EXTRA /tmp/mount

        cat <<'EOF' > /etc/yum.repos.d/extra.repo
        [extra]
        name=extra
        baseurl=file:///tmp/mount
        enabled=1
        EOF

        dnf -y install famousdatabase

       Для apt створіть файл /tmp/install.sh із таким вмістом:

        mkdir /tmp/mount
        mount LABEL=EXTRA /tmp/mount

        apt-cdrom -d=/tmp/mount add
        apt-get -y install famousdatabase

       Скористайтеся параметром --attach для долучення компакт-диска або образу диска та параметром --run для запуску скрипту:

        virt-builder fedora-27 \
          --attach extra-packages.iso \
          --run /tmp/install.sh

   КОРИСТУВАЧІ І ПАРОЛІ
       Параметр --root-password використовується для зміни пароля адміністратора (root) (якщо ви не скористаєтеся цим параметром, буде використано випадковий пароль). Цьому параметру можна передати
       "ВАРІАНТ" пароля у одному з таких форматів:

       --root-password file:НАЗВА_ФАЙЛА
           Прочитати пароль адміністратора з файла "НАЗВА_ФАЙЛА". Паролем вважатиметься вміст усього першого рядка цього файла. Усі інші рядки файла буде проігноровано. Файл має бути створено із режимом
           доступу 0600, щоб його не могли читати сторонні користувачі.

       --root-password password:ПАРОЛЬ
           Встановити для пароля root буквальне значення рядка "ПАРОЛЬ".

           Зауваження: цей спосіб не є безпечним, оскільки будь-який користувач комп'ютера зможе побачити пароль явним чином за допомогою команди ps(1).

       --root-password random
           Вибрати випадковий пароль, який буде виведено до stdout. Випадковість пароля наближено відповідатиме 120-бітовій.

           Типове значення.

       --root-password disabled
           Пароль для облікового запису root вимкнено. Це так, ніби у полі пароля використано "*".

       --root-password locked:file:НАЗВА_ФАЙЛА
       --root-password locked:password:ПАРОЛЬ
       --root-password locked:random
           Обліковий запис root заблоковано, але для нього визначено пароль. Якщо обліковий запис буде вперше розблоковано (за допомогою "passwd -u"), для входу до нього буде використано вказаний пароль.

       --root-password locked
       --root-password locked:disabled
           Обліковий запис root і пароль вимкнено.

       Створення облікових записів користувачів

       Для створення облікових записів користувачів скористайтеся командою useradd(8) з параметром --firstboot-command, ось так:

        virt-builder --firstboot-command \
           'useradd -m -p "" rjones ; chage -d 0 rjones'

       Вказана вище команда створить обліковий запис "rjones" без пароля і примусить користувача встановити пароль під час першого входу до системи. Існують і інші способи керування паролями, див.
       useradd(8), щоб дізнатися більше.

   РОЗКЛАДКА КЛАВІАТУРИ
       Оскільки існує багато різних способів встановити розкладку клавіатури у дистрибутивах Linux, у virt-builder усе ще немає простого параметра командного рядка для виконання цієї дії. У цьому розділі
       наведено настанови щодо встановлення розкладки для деяких типових дистрибутивів Linux.

       Визначення розкладки клавіатури за допомогою systemd

       У дистрибутивах, де використовується "localectl" зі складу systemd, скористайтеся такою командою:

        virt-builder fedora-27 \
          --firstboot-command 'localectl set-keymap uk'

       Докладніший опис можна знайти за посиланнями localectl(1) та https://www.happyassassin.net/2013/11/23/keyboard-layouts-in-fedora-20-and-previously/.

       Визначення розкладки клавіатури за допомогою /etc/sysconfig/keyboard

       Для RHEL ≤ 6, Fedora ≤ 18 та подібних систем можна вивантажити із змінити файл налаштувань клавіатури за допомогою параметрів --upload, --write або --edit. Приклад:

        virt-builder centos-6 \
          --edit '/etc/sysconfig/keyboard: s/^KEYTABLE=.*/KEYTABLE="uk"/'

       Документацію щодо формату даних цього файла можна знайти на багатьох сторінках інтернету.

       Визначення розкладки клавіатури у дистрибутивах на основі Debian

       У заснованих на Debian дистрибутивах мети можна досягти за допомогою файла /etc/default/keyboard. Вивантажити або внести зміни до цього файла можна за допомогою параметрів --upload, --write та
       --edit. Приклад:

        virt-builder debian-8 \
          --edit '/etc/default/keyboard: s/^XKBLAYOUT=.*/XKBLAYOUT="gb"/'

       Див. https://wiki.debian.org/Keyboard.

   МОВА
       У більшості дистрибутивів Linux передбачено можливість зміни локалі, отже ви можете бачити повідомлення гостьової системи нестандартною мовою, наприклад українською.

       Втім, єдиного параметра, який контролює локаль, немає, оскільки для реалізації підтримки мови може знадобитися встановлення додаткових пакунків, зокрема шрифтів для консолі і графічної оболонки,
       способів введення символів запису мови з клавіатури. Назви потрібних для цього пакунків та їхні налаштування залежать від дистрибутиву, отже, virt-builder просто не може про них знати.

       У цьому розділі наведено приклади для типових дистрибутивів Linux.

       Встановлення японської локалі у Fedora 25

        virt-builder fedora-27 \
          --size 20G \
          --update \
          --install @japanese-support \
          --install @xfce \
          --install xorg-x11-server-Xorg,xorg-x11-drivers,rsyslog \
          --link /usr/lib/systemd/system/graphical.target:/etc/systemd/system/default.target \
          --firstboot-command 'localectl set-locale LANG=ja_JP.utf8' \
          --firstboot-command 'localectl set-keymap jp' \
          --firstboot-command 'systemctl isolate graphical.target'

       Встановлення японської мови для Debian 8 (Jessie)

       Зауважте, що, хоча вказана команда вмикає японську і у текстовій консолі, навряд чи у консолі ви побачите належним чином показані ієрогліфи. Втім, японські ієрогліфи має бути показано у графічних
       програмах і терміналах.

        pkgs=locales,xfce4,\
        ibus,ibus-anthy,\
        fonts-ipafont-gothic,fonts-ipafont-mincho,\
        fonts-takao-mincho,\
        xfonts-intl-japanese,xfonts-intl-japanese-big,\
        iceweasel-l10n-ja,manpages-ja

        virt-builder debian-8 \
          --size 20G \
          --install $pkgs \
          --edit '/etc/locale.gen: s,^#\s*ja,ja,' \
          --write '/etc/default/locale:LANG="ja_JP.UTF-8"' \
          --run-command "locale-gen"

   ФАЙЛ ЖУРНАЛУ
       Скрипти та засоби встановлення пакунків, які працюватимуть під час збирання (--run, --run-command, --install, --update, але не firstboot), записуватимуть повідомлення до одного з таких файлів:

       /tmp/builder.log
           У Linux, BSD та інших гостьових системах, відмінних від Windows.

       C:\Temp\builder.log
           У гостьових системах Windows, DOS.

       /builder.log
           Якщо немає /tmp або C:\Temp.

       Якщо ви не хочете, щоб до остаточного образу було записано файл журналу, скористайтеся параметром рядка команди --no-logfile.

   КЛЮЧІ SSH
       Параметр --ssh-inject використовується для вставляння ключів ssh для користувачів у гостьовій системі, щоб вони могли входити до системи без зазначення пароля.

       Частина "ВАРІАНТ" параметра є необов'язковою; у нашому випадку --ssh-inject "КОРИСТУВАЧ" означає, що ми шукаємо ~/.ssh у каталозі поточного користувача для визначення типового файла відкритого
       ідентифікатора. Саме знайдений ключ і буде вивантажено до гостьової системи. «Типовий відкритий ідентифікатор» є файлом default_ID_file, який описано у підручнику з ssh-copy-id(1).

       Якщо вказано, "ВАРІАНТ" можна зазначити у одному з таких форматів:

       --ssh-inject КОРИСТУВАЧ:file:НАЗВА_ФАЙЛА
           Прочитати ключ ssh з файла НАЗВА ФАЙЛА. Файлом зазвичай є файл .pub.

       --ssh-inject КОРИСТУВАЧ:string:РЯДОК_КЛЮЧА
           Використати вказаний "РЯДОК_КЛЮЧА". Зазвичай, "РЯДОК_КЛЮЧА" — рядок відкритого ключа у форматі ssh-rsa AAAA.... user@localhost.

       Який би з варіантів не було вибрано, буде створено каталог ~USER/.ssh і файл ~USER/.ssh/authorized_keys, якщо вони досі не існували.

   СКРИПТИ ПЕРШОГО ЗАВАНТАЖЕННЯ
       За допомогою параметрів --firstboot та --firstboot-command ви можете визначити команди, які буде виконано під час першого завантаження гостьової системи. Для цього у гостьовій системі
       встановлюється скрипт ініціалізації, який виконує завдання із запуску усіх доданих скриптів і виконання усіх доданих команд.

       Підтримувані операційні системи:

       Linux
           Передбачено підтримку таких систем ініціалізації: systemd, System-V init (також відома як sysvinit) та Upstart (з використанням скриптів System-V).

           Зауважте, що, зазвичай, скрипти ініціалізації виконуються від імені адміністратора (root), але у набагато обмеженішому середовищі ніж те, яке доступне зі звичайної оболонки. Наприклад,
           значення змінної середовища $HOME може бути не встановленим або порожнім.

           Дані, виведені скриптами першого запуску, у гостьовій системі зберігатимуться у ~root/virt-sysprep-firstboot.log.

       Windows
           Для запуску скриптів першого завантаження встановлюється rhsrvany.exe, початковий код якого можна знайти у https://github.com/rwmjones/rhsrvany, або pvvxsvc.exe, який є частиною SUSE VMDP.
           Наявність цих файлів є обов'язковою. Якщо файлів не буде знайдено, скрипти першого завантаження виконати не вдасться.

           rhsrvany.exe або pvvxsvc.exe буде просто скопійовано з місця, на яке вказує змінна середовища "VIRT_TOOLS_DATA_DIR"; якщо значення змінної середовища не встановлено, буде використано типове
           місце, визначене під час компіляції (щось схоже на /usr/share/virt-tools).

           Дані, виведені скриптами першого завантаження, можна знайти у гостьовій системі за адресою C:\Program Files\Guestfs\Firstboot\log.txt.

   SUBSCRIPTION-MANAGER
       Передбачено можливість автоматизації реєстрації та долучення до системи передплат за допомогою "subscription-manager". Потреба у подібному налаштовуванні типово виникає у системах Red Hat
       Enterprise Linux. Передбачено декілька параметрів, які спрощують процедуру, усувають потребу у введенні команд вручну та не роблять загальнодоступними паролі, вказані у рядку команди.

       --sm-register запускає процедуру реєстрації і потребує зазначення --sm-credentials. Слід використовувати для параметра "ВАРІАНТ" --sm-credentials один з таких форматів:

       --sm-credentials КОРИСТУВАЧ:file:НАЗВА_ФАЙЛА
           Прочитати пароль для вказаного користувача "КОРИСТУВАЧ" з файла НАЗВА_ФАЙЛА.

       --sm-credentials КОРИСТУВАЧ:password:ПАРОЛЬ
           Використати рядок "ПАРОЛЬ" для вказаного користувача "КОРИСТУВАЧ".

       --sm-attach долучає систему до передплачених послуг; формат варіантів команди може бути одним з таких:

       --sm-attach auto
           "subscription-manager" долучається до найвідповідніших передплат для системи.

       --sm-attach file:НАЗВА_ФАЙЛА
           Прочитати ідентифікатор буфера з файла НАЗВА_ФАЙЛА.

       --sm-attach pool:БУФЕР
           Використовувати рядок "БУФЕР" як ідентифікатор буфера.

       --sm-remove вилучає усі передплати з гостьової системи, а --sm-unregister повністю знімає систему з реєстрації.

   ПРОЦЕДУРА ВСТАНОВЛЕННЯ
       Після виклику virt-builder встановлення виконується таким чином:

       •   Отримується образ шаблону.

           Якщо образ шаблону вже є у кеші, використовується кешована версія. (Див. "КЕШУВАННЯ").

       •   Перевіряється підпис шаблону.

       •   Шаблон розпаковується до файла tmp.

       •   Розмір образ шаблону змінюється так, щоб від дорівнював розміру системи призначення, за допомогою virt-resize(1).

       •   Долучаються додаткові диски (--attach).

       •   Створюється нова база псевдовипадкових чисел для гостьової системи.

       •   Виконується налаштовування гостьової системи у порядку, який задається рядком команди.

       •   SELinux relabelling is done unless disabled with --no-selinux-relabel.

   ІМПОРТУВАННЯ ОБРАЗУ ДИСКА
       Імпортування до libvirt

       Імпортування образу диска до libvirt за допомогою параметра virt-install(1) --import.

        virt-install --import \
          --name guest --ram 2048 \
          --disk path=disk.img,format=raw --os-variant fedora27

       Нотатки:

       1.  Вам слід вказати правильний формат. Форматом є "raw", якщо вами не було використано параметр virt-builder --format.

       2.  Наполегливо рекомендуємо скористатися --os-variant, оскільки він надає змогу підібрати оптимальний набір пристроїв, які слід увімкнути у системі, щоб гостьова система працювала найефективніше.
           Щоб отримати список усіх варіантів, скористайтеся такою командою:

            osinfo-query ОС

           Вказана вище програма є частиною пакунка libosinfo.

       3.  Запускати virt-install можна від імені адміністратора (root) або від імені простого користувача. Між цими способами є незначні відмінності, оскільки libvirt керує різними наборами віртуальних
           машин для кожного користувача. Зокрема, virt-manager показує віртуальні машини, власником яких є root, а «Коробки» з GNOME показують лише віртуальні машини поточного користувача. Інші ж
           програми можуть також мати свої особливості показу.

       Імпортування до OpenStack

       Імпортувати образ до Glance (сховища образів OpenStack) можна такими командами:

        glance image-create --name fedora-27-image --file fedora-27.img \
          --disk-format raw --container-format bare \
          --is-public True

       Параметр --file визначає створений за допомогою virt-builder образ диска. Його значення має узгоджуватися із значення параметра --output virt-builder. Значення параметра --disk-format має
       узгоджуватися зі значенням параметра --format virt-builder (або бути рівним "raw", якщо ви не вказували цього параметра). Значенням параметра --container-format завжди має бути "bare", оскільки
       virt-builder ніколи не вкладає образ до контейнерів.

       Ви можете скористатися командою "glance image-show fedora-27-image", щоб переглянути властивості образу.

       Для завантаження екземпляра вашого образу на обчислювальному вузлі Nova віддайте таку команду:

        nova boot fedora-27-server --image fedora-27-image \
          --flavor m1.medium

       Скористайтеся командою "nova flavor-list", щоб переглянути список можливих варіантів машин. Скористайтеся командою "nova list", щоб переглянути список запущених екземплярів.

       Безпосереднє завантаження за допомогою qemu або KVM

       Командний рядок qemu не є ні надто стабільним, ні простим у користуванні, тому, якщо це можливо, слід користуватися libvirt. Втім, для завантаження віртуальної машини можна скористатися чимось
       подібним до вказаного нижче:

        qemu-system-x86_64 \
          -machine accel=kvm:tcg \
          -cpu host \
          -m 2048 \
          -drive file=disk.img,format=raw,if=virtio

       Як і з libvirt, дуже важливо вибрати правильний формат. Цим форматом буде "raw", якщо раніше не було використано параметр --format.

   КЕРУВАННЯ НАЛАШТУВАННЯМИ
       Puppet

       Щоб увімкнути агент Puppet у гостьовій системі, встановіть пакунок, вкажіть налаштування на вашому Puppetmaster і забезпечте запуск агента під час завантаження.

       Типовою командою virt-builder буде:

        virt-builder fedora-27 \
          --hostname client.example.com \
          --update \
          --install puppet \
          --append-line '/etc/puppet/puppet.conf:[agent]' \
          --append-line '/etc/puppet/puppet.conf:server = puppetmaster.example.com/' \
          --run-command 'systemctl enable puppet'

       Точний перелік настанов залежить від дистрибутива Linux. Докладніше про це тут: https://docs.puppet.com/puppet/latest/install_pre.html

   ДІАГНОСТИКА ЗБИРАННЯ
       Якщо сам virt-builder не може виконати роботу, слід увімкнути діагностику (-v) і повідомити про ваду розробників (див. розділ "ВАДИ" нижче).

       Якщо причиною неможливості виконання завдання virt-builder є який скрипт або пакунок, який програма не може встановити, спробуйте скористатися параметром --no-delete-on-failure, щоб зберегти файл
       результатів, і продовжіть вивчення цього розділу підручника.

       Якщо virt-builder успішно завершує роботу, але образ не працює, ось чим слід скористатися:

       Використання virt-rescue
           Запустити virt-rescue(1) над образом диска:

            virt-rescue -a disk.img

           Ви потрапите до оболонки порятунку. Ви зможете змонтувати файлові системи з образу диска до /sysroot і вивчити їх за допомогою звичних команд Linux. Ви також можете скористатися chroot щодо
           гостьової системи і перевстановити у ній завантажувач. На сторінці підручника з virt-rescue наведено набагато більше інформації та прикладів.

       Використання guestfish
           Запустити guestfish(1) над образом диска:

            guestfish -a disk.img -i

           Скористайтеся командами guestfish, зокрема "ll /каталог" і "cat /файл", для перевірки каталогів та файлів.

       Використання guestmount
           Безпечно змонтувати образ диска у основній системі за допомогою FUSE і guestmount(1):

            mkdir /tmp/mp
            guestmount -a disk.img -i /tmp/mp
            cd /tmp/mp

           Щоб демонтувати образ диска, виконайте такі дії:

            fusermount -u /tmp/mp

       Додати послідовну консоль
           Якщо гостьова система повисає під час завантаження, може допомогти додавання послідовної консолі у гостьову систему і спрямовування повідомлень ядра до послідовної консолі. Додавання
           послідовної консолі потребує вивчення документації до вашого гіпервізору. Щоб спрямувати повідомлення ядра до послідовної консолі, додайте таку частину до командного рядка ядра:

            console=tty0 console=ttyS0,115200

   ДЖЕРЕЛА ШАБЛОНІВ
       virt-builder читає доступні джерела із файлів налаштування, файлів із суфіксом назви .conf, які зберігаються у одному з таких місць:

       •   $XDG_CONFIG_HOME/virt-builder/reposd/ ($XDG_CONFIG_HOME дорівнює $HOME/.config, якщо не встановлено).

       •   $VIRT_BUILDER_DIRS/virt-builder/repos.d/ (where $VIRT_BUILDER_DIRS means any of the directories in that environment variable, or just /etc if not set).

       Кожен з файлів .conf у вказаних каталогах зберігає дані у простому текстовому форматі, ось так:

        [libguestfs.org]
        uri=http://libguestfs.org/download/builder/index.asc
        gpgkey=file:///etc/xdg/virt-builder/repos.d/libguestfs.gpg

       Частина у квадратних дужках є ідентифікатором сховища, який використовується як унікальний ідентифікатор.

       Можуть з’явитися такі поля:

       "uri=АДРЕСА"
           Адреса файла покажчика, на який посилається це сховище.

           Це поле слід заповнити.

       "gpgkey=АДРЕСА"
           Це необов'язкове поле відповідає адресі (хоча прийнятними є лише адреси file://) ключа, який використано для підписування файла покажчика. Якщо поля немає, файл покажчика, на який посилається
           uri=.., не підписано.

       "proxy=РЕЖИМ"
           Це необов'язкове поле вказує на режим проксі, яким слід скористатися для отримання файла покажчика цього сховища. Можливі значення:

           no, off
               Не використовувати проксі взагалі, незважаючи на  налаштування системи.

           system
               Використаний проксі-сервер є системним.

           усе інше
               Задає справжні налаштування проксі, якими слід скористатися, незважаючи на налаштування системи.

           Якщо значення не вказано, буде використано параметри проксі-сервера системи (тобто все буде так, наче вказано system).

       "format=ФОРМАТ"
           Це необов'язкове поле задає формат сховища. Можливі такі значення:

           native
               Природний формат сховища "virt-builder". Див. також розділ "Створення і підписування файла покажчика" нижче.

           simplestreams
               Адреса, яка визначає кореневий каталог ієрархії метаданих Simple Streams версії 1.0.

               Докладніший опис Simple Streams наведено тут: https://launchpad.net/simplestreams.

           Якщо не вказано, типовим значенням буде "native".

       Якщо ви часто користуватиметеся virt-builder, варто створити власне сховище шаблонів.

       Сховище libguestfs.org

       Від початку, virt-builder отримує файл http://libguestfs.org/download/builder/index.asc, який є покажчиком усіх доступних шаблонів, і деяку інформацію щодо кожного з них, яку додано до цифрового
       підпису. За допомогою команди "virt-builder --list" можна ознайомитися із усіма даними щодо цього файла покажчика.

       Шаблони, які зберігаються на libguestfs.org, було створено за допомогою скриптів командної оболонки, файлів kickstart та файлів, які можна знайти у ієрархії коду libguestfs, у каталозі
       "builder/templates".

       Налаштовування доступу до сховища

       Ви можете створити власний сайт із файлом покажчика (index) і деякими шаблонами, а потім вказати virt-builder на цей сайт за допомогою вмісту файла .conf.

       Зауважте, що якщо ваш покажчик підписано, вам слід належним чином заповнити поле gpgkey=.. у вашому файлі .conf, а також додати файл ключа GPG.

        virt-builder --source https://example.com/builder/index.asc \
           --fingerprint 'AAAA BBBB ...' \
           --list

       Ви можете розмістити сайт будь-якому мережевому сервері або сервері FTP чи у локальній або мережевій файловій системі.

       Встановлення ключа GPG

       Якщо у вас ще немає ключа GnuPG, вам слід налаштувати такий. (Строго кажучи, це не є обов'язковою умовою, але якщо ваш файл покажчика і файл шаблона не буде підписано, користувачам virt-builder
       доведеться додавати параметр --no-check-signature до команди кожного разу, коли їм потрібно буде скористатися virt-builder.)

       Інструкцію зі створення ключа можна знайти у підручнику з GPG: http://www.gnupg.org/gph/en/manual.html.

       Експортувати ваш відкрити ключ GPG:

        gpg --export -a "you@example.com" > pubkey

       Створення шаблонів

       Існує багато способів створення шаблонів. Наприклад, ви можете клонувати наявні гостьові системи (див. virt-sysprep(1)) або встановити гостьову систему вручну (virt-install(1)). Щоб ознайомитися
       із способами створення шаблонів для virt-builder, вивчіть скрипти у "builder/templates"

       У virt-builder передбачено підтримку усіх форматів образів (наприклад, raw, qcow2 тощо) як шаблонів, у звичайному форматі та у форматі, стисненому XZ. Таким чином, як шаблонами можна скористатися
       наявними образами (наприклад, образами, очищеними за допомогою virt-sysprep(1)).

       Для досягнення найкращих результатів під час стискання шаблонів скористайтеся такими параметрами програми xz (пояснення щодо цих параметрів можна знайти на сторінці довідки до
       nbdkit-xz-plugin(1)):

        xz --best --block-size=16777216 disk

       Створення і підписування файла покажчика

       Файл покажчика записується у простому текстовому форматі (тут показано без цифрового підпису):

        [fedora-18]
        name=Fedora® 18
        osinfo=fedora18
        arch=x86_64
        file=fedora-18.xz
        checksum[sha512]=...
        format=raw
        size=6442450944
        compressed_size=148947524
        expand=/dev/sda3

        [fedora-19]
        name=Fedora® 19
        osinfo=fedora19
        arch=x86_64
        file=fedora-19.xz
        checksum[sha512]=...
        revision=3
        format=raw
        size=4294967296
        compressed_size=172190964
        expand=/dev/sda3

       Частина у квадратних дужках є "версією-ОС", тим самим рядком, який використано у рядку команди virt-builder, використаному для збирання цієї операційної системи.

       Спростити створення і підписування файла покажчика можна за допомогою програми virt-builder-repository(1).

       Після приготування файла "index" у належному форматі підпишіть його такою командою:

        gpg --clearsign --armor index

       У результаті виконання цієї команди буде створено остаточний файл із назвою index.asc, який можна вивантажити на сервер (і додати у запис адреси uri=..). Як ми вже зауважували вище, підписування
       файла покажчика є необов'язковим, але рекомендованим.

       Можуть з’явитися такі поля:

       "name=НАЗВА"
           Зручна для користувача назва цього шаблона. Назву буде показано у виведених даних команди з параметром --list, більше ніде програма її не використовує.

       "osinfo=ІДЕНТИФІКАТОР"
           Це додаткове поле пов'язує операційну систему із відповідним ідентифікатором libosinfo.  Virt-builder (ще) не використовує ці дані.

       "arch=АРХІТЕКТУРА"
           Архітектура операційної системи, яку встановлено у цьому шаблоні. Це поле є обов'язковим.

       "file=ШЛЯХ"
           Шлях (відносно покажчика) стисненого xz шаблона.

           Зауважте, що тут не можна використовувати абсолютні шляхи або адреси файлів. Причиною є те, що у virt-builder використовується правило «одного походження» для шаблонів, тому вони не можуть
           походити з інших серверів.

       "sig=ШЛЯХ"
           Цей параметр вважається застарілим. Використовуйте замість нього поле контрольної суми (checksum).

           Шлях (відносно покажчика) від'єднаного підпису GPG файла xz.

           Зауважте, що тут не можна використовувати абсолютні шляхи або адреси файлів. Причиною є те, що у virt-builder використовується правило «одного походження» для шаблонів, тому вони не можуть
           походити з інших серверів.

           Файл можна створити такою командою:

            gpg --detach-sign --armor -o disk.xz.sig disk.xz

       "checksum[sha512]=7b882fe9b82eb0fef..."
           Контрольну суму SHA-512 файла, вказаного у виразі file=.., буде перевірено після завершення отримання даних. Для визначення підпису скористайтеся такою командою:

            sha512sum disk.xz

           Зауважте, що якщо ви користуєтеся цим параметром, вам не потрібно підписувати файл, тобто використовувати параметр "sig". Цей параметр має вищий пріоритет за параметра "sig".

       "checksum=7b882fe9b82eb0fef..."
           "checksum" є скороченою формою запису "checksum[sha512]".

           Якщо вам доводиться працювати з virt-builder = 1.24.0, слід користуватися "checksum", оскільки ця версію видаватиме повідомлення про помилку обробки, якщо у ключі поля використано квадратні
           дужки і цифри. Цю помилку виправлено у версіях virt-builder ≥ 1.24.1.

       "revision=N"
           Модифікація (revision) — ціле число, яке використовується для керування кешем шаблонів. Збільшення номера модифікації призводить до того, що клієнти отримують шаблон, навіть якщо у них є копія
           у кеші.

           Номер модифікації є необов’язковим. Якщо його не вказано, типовим значенням вважається 1.

       "format=raw"
       "format=qcow2"
           Визначає формат образу диска; якщо дані стиснено, слід вказати формат до стискання. Якщо формат не вказано, його буде визначено автоматично, але все ж варто явним чином вказати бажаний формат.

           Зауважте, що це формат початкових даних, який відрізняється від параметра --format (бажаний формат результату). Virt-builder виконує перетворення «на льоту» з початкового формату до бажаного
           формату результату.

       "size=NNN"
           Віртуальний розмір образу у байтах. Це розмір нестисненого образу. Якщо використано формат, відмінний від raw, зокрема qcow2, це значення означає розмір віртуального диска, а не розмір файла
           qcow2.

           Це поле слід заповнити.

           Virt-builder також використовує це значення як мінімальний розмір, запит щодо якого можуть надсилати користувачів за допомогою параметра --size, або типовий розмір, якщо не вказано параметр
           --size.

       "compressed_size=NNN"
           Справжній розмір образу диска у байтах, тобто розмір, який було вказано у file=... Це значення використовується лише для інформування (якщо використовуються формати "long" і "json" у параметрі
           --list).

       "expand=/dev/sdaX"
           При розпаковуванні образу до його остаточного розміру, наказати virt-resize(1) розпакувати дані до іменованого розділу у образі гостьової системи для заповнення усього доступного місця. Це
           працює подібно до параметра --expand virt-resize.

           Тут вам зазвичай слід вказати назву пристрою у кореневій файловій системі гостьової операційної системи.

           Цим елементом варто скористатися, але це не обов'язково. Якщо поле пропущено, virt-resize створить додатковий розділ наприкінці диска для заповнення порожнього місця, що набагато менш зручно.

       "lvexpand=/пристрій/група_томів/логічний_том"
           При розпаковуванні образу до його остаточного розміру, наказати virt-resize(1) розпакувати дані до іменованого логічного тому у образі гостьової системи для заповнення усього доступного місця.
           Це працює подібно до параметра --lv-expand virt-resize.

           Якщо у гостьовій системі використовується LVM2, тут слід вказати логічний том кореневої файлової системи гостьової операційної системи. Якщо у гостьовій операційній системі не використовується
           LVM2 або її коренева файлова система не зберігається на логічному томі, не використовуйте цей параметр.

       "notes=НОТАТКИ"
           Будь-які нотатки, які стосуються цього образу, особливо нотатки із описом пакунків образу, способу створення образу та даних щодо ліцензування.

           Ці дані буде виведено у режимах --notes і --list --long.

           Ви можете створювати багаторядкові нотатки додаванням принаймні одного пробілу на початку кожного рядка (навіть порожнього):

            notes=Цей образ було створено за допомогою
             такого скрипту kickstart:
                                           <-- один пробіл на початку рядка
             part /boot --fstype ext3
             ...

       "hidden=true"
           Використання прапорця hidden усуває шаблон зі списку, який буде показано у відповідь на використання параметра --list (лишаючи образ придатним до встановлення). Цей прапорець використовується
           для тестових образів.

       "aliases=ПСЕВДОНІМ1 ПСЕВДОНІМ2 ..."
           Це необов'язкове поле визначає список альтернативних назв, відокремлених пробілами, для образу. Альтернативною назвою, наприклад, можна скористатися так, щоб вона завжди вказувала на
           найсвіжішу версію певного образу, лишаючи інші, старіші версії доступними у покажчику, замість оновлення того самого образу (див. поле "revision").

       Запуск virt-builder для декількох джерел одночасно

       У virt-builder передбачено можливість використання декількох джерел. Рекомендованим способом є розгортання файлів .conf, які вказують на файли покажчика. Іншим способом є визначення джерел за
       допомогою декількох параметрів --source і/або --fingerprint:

        virt-builder \
          --source http://example.com/s1/index.asc \
          --source http://example.com/s2/index.asc

       Ви можете надати N відбитків або 1 відбиток. Якщо буде надано N відбитків, N = кількості джерел, а між джерелом і відбитком є однозначна відповідність:

        virt-builder \
          --source http://example.com/s1/index.asc --fingerprint '0123 ...' \
          --source http://example.com/s2/index.asc --fingerprint '9876 ...'

       Якщо вами буде надано один відбиток, його буде використано для усіх джерел.

       Вам "слід" надати принаймні 1 відбиток.

       Ліцензування шаблонів

       Вам слід зважати на ліцензування образів, які ви розповсюджуєте. Для гостьових систем із відкритим кодом слід надавати посилання на початковий код у полі "notes" і виконувати інші вимоги
       (наприклад, вимоги щодо торгівельних знаків).

       Формальна специфікація файла покажчика

       Формат файла покажчика має формальну специфікацію, що визначається сканером flex і обробником bison, що використовуються для обробки файла. Її можна знайти у таких файлах у ієрархію коду
       libguestfs:

        builder/index-scan.l
        builder/index-parse.y

       Для перевірки коректності файла покажчика використовується програма із назвою virt-index-validate(1).

       Зауважте, що обробник і інструмент може працювати як із підписаним, так і з непідписаним файлом покажчика (тобто з index або зindex.asc).

       Кодуванням покажчика завжди є UTF-8.

   КЕШУВАННЯ
       Кешування шаблонів

       Оскільки шаблоні зазвичай є дуже великими, отримані шаблони зберігають у кеші домашнього каталогу користувача.

       Кеш розміщується у $XDG_CACHE_HOME/virt-builder/ або $HOME/.cache/virt-builder.

       Ви можете отримати дані щодо каталогу кешу, зокрема дані щодо того, які гостьові системи кешуються, за допомогою такої команди:

        virt-builder --print-cache

       Кеш можна вилучити з метою економії місця на диску такою командою:

        virt-builder --delete-cache

       Ви можете отримати усі (поточні) шаблони до локального кешу командою:

        virt-builder --cache-all-templates

       Щоб вимкнути кешування шаблонів, скористайтеся параметром --no-cache.

       Кешуванню підлягають лише шаблони. Для покажчика та цифрових підписів кешування не використовується.

       Кешування пакунків

       Virt-builder використовує для отримання файлів curl(1), а також використовує поточні параметри "http_proxy" (та інші) під час встановлення пакунків (--install, --update).

       Тому ви можете встановити ці змінні середовища з метою максимізації обсягу локального кешування. Див. "ЗМІННІ СЕРЕДОВИЩА" та curl(1).

       Локальні дзеркала

       Щоб збільшити швидкість і надійність встановлення пакунків, ви можете налаштувати локальне дзеркало для дистрибутива призначення і вказати на нього засобу керування пакунками гостьової системи.

       Використання локального дзеркала з Fedora

       Для встановлення гостьової системи Fedora за допомогою локального дзеркала:

        virt-builder fedora-27 \
          --edit '/etc/yum.repos.d/fedora.repo:
              s{.*baseurl=.*}{baseurl=http://example.com/mirror/};
              s{.*metalink=.*}{};
          ' \
          --edit '/etc/yum.repos.d/fedora-updates.repo:
              s{.*baseurl=.*}{baseurl=http://example.com/mirror-updates/};
              s{.*metalink=.*}{};
          ' \
          --run-command 'dnf -y update' \
          --install 'pkg1,pkg2,...'

       Використання локального дзеркала з Debian

       Припускаємо, що ви використовуєте "apt-proxy" для віддзеркалення сховища, тоді вам слід створити новий файл sources.list для визначення вашого проксі-сервера (див.
       https://help.ubuntu.com/community/AptProxy), а потім віддайте таку команду:

        virt-builder debian-8 \
          --upload sources.list:/etc/apt/sources.list \
          --run-command 'apt-get -y update' \
          --install 'пакунок1,пакунок2,...'

   ЦИФРОВІ ПІДПИСИ
       Virt-builder використовує GNU Privacy Guard (GnuPG або gpg) для забезпечення невтручання до покажчика і шаблонів.

       Джерело вказує на файл покажчика, який можна підписати.

       Virt-builder отримує покажчик і перевіряє, чи є підпис коректним і чи збігається відбиток підписника із вказаним відбитком (тобто відбитком, вказаним за допомогою gpgkey=.. у .conf або за
       допомогою --fingerprint, саме у цьому порядку).

       Для перевірки відповідності щодо вбудованого відкритого ключа або відбитка, відкритий ключ слід імпортувати до локального сховища ключів gpg користувача (саме так працює gpg).

       Під час отримання шаблона його підпис буде перевірено у той самий спосіб.

       Хоча підписи і не є обов'язковими, якщо ви їх не використаєте, користувачам virt-builder доведеться використовувати параметр --no-check-signature у рядку команди. За допомогою підпису можна
       запобігти заміні зловмисником підписаного файла покажчика непідписаним файлом. При цьому virt-builder без перевірки підпису не повідомлятиме про підміну. Щоб там не сталося, наполегливо
       рекомендуємо вам створювати підписаний покажчик і шаблони.

   АРХІТЕКТУРА
       Virt-builder може збирати образ гостьової системи для будь-якої архітектури, незалежно від архітектури основної системи. Наприклад, можна зібрати образ гостьової системи архітектури x86-64 на
       основній системі архітектури ARM.

       Втім, деякі з параметрів не працюватимуть, особливо параметри, які потребують виконання команд у гостьовій системі під час процесу збирання: --install, --update, --run, --run-command. Вам варто
       замінити ці команди на їхні еквіваленти у firstboot.

       Основна система архітектури x86-64, збираючи гостьові системи 32-бітової архітектури i686, має працювати без використання будь-яких додаткових кроків налаштовування.

   БЕЗПЕКА
       Virt-builder не потребує запуску від імені користувача root (фактично, програму не слід запускати від імені root) і не використовує setuid, "sudo" або будь-яких інших подібних механізмів.

       --install, --update, --run і --run-command реалізовано за допомогою базової системи (невеличкої віртуальної машини), тому ці команди не працюватимуть у основній системі. Якщо ви користуєтеся
       модулем libvirt libguestfs і у системі увімкнено SELinux , віртуальну машину буде додатково огорнуто у контейнер SELinux (sVirt).

       Втім, ці параметри отримуватимуть доступ до мережі основної системи і, оскільки шаблон може містити шахрайський код, цей код може намагатися отримати доступ до ресурсів мережі основної системи,
       які мають бути недоступними для нього. Для запобігання небажаному доступу ви можете скористатися параметром --no-network.

       Команди першого завантаження виконуються у контексті гостьової системи, тому слід брати до уваги параметри захисту у вашому гіпервізорі або обчислювальній хмарі.

       Virt-builder додає випадкову базу псевдовипадкових чисел до кожної гостьової системи, яку зібрано за його допомогою. Це допомагає забезпеченню справжньої випадковості номерів послідовності TCP,
       UUID, ключів вузла ssh тощо під час завантаження гостьової системи.

       Вам слід перевіряти цифрові підписи і не ігнорувати повідомлення про помилки під час таких перевірок.

   КЛОНИ
       Якщо вам потрібно створити багато гостьових систем одного типу, виникає спокуса запустити virt-builder один раз, а потім просто скопіювати файл-результат. Втім, так не слід робити. Вам слід
       запустити virt-builder окремо для кожної нової гостьової системи, яку ви хочете створити.

       Так слід робити тому, що кожен клон повинен мати (принаймні) окрему базу для псевдовипадкових чисел, а також, ймовірно, інші унікальні властивості (зокрема UUID файлових систем) у майбутніх
       версіях virt-builder.

       Ще однією річчю, яку вам не слід робити, є клонування завантаженого образу диска. Причиною цього є те, що деякі гостьові системи створюють унікальні ідентифікатори машини, ключі SSH вузла та інші
       дані під час першого завантаження, а дублювання таких ідентифікаторів у клонах є вкрай небажаним.

       Див. також virt-sysprep(1).

   ШВИДКОДІЯ
       Найважливішим аспектом пришвидшення роботи програми є кешування. Шаблон завантажується до кешу, коли його вперше використовують, або якщо було використано параметр команди --cache-all-templates.
       Докладніше про це у розділі "КЕШУВАННЯ" вище.

       Пакунки, потрібні для виконання завдань із параметрами --install та --update, отримуються за допомогою з'єднання з мережею основної системи. Встановлення значень змінних середовища "http_proxy",
       "https_proxy" та "ftp_proxy" таким чином, щоб вони вказували на локальний кеш, може забезпечити режим, за якого ці пакунки отримуватимуться із інтернету лише один раз. Ви також можете спробувати
       скористатися локальним сховищем пакунків, хоча налаштовування такого сховища може бути складною справою, специфічною для того дистрибутива Linux, який ви намагаєтеся встановити.

       Користування --no-sync

       Скористайтеся --no-sync.  Втім, ознайомтеся із можливими проблемами, описаними у розділі "ПАРАМЕТРИ" вище, оскільки це може призвести до пошкодження даних на диску, якщо використовувати
       неправильно.

       Пропускання virt-resize

       За певних умов virt-builder може пропускати крок virt-resize. Це значно пришвидшує роботу virt-builder. Умови пропускання є такими:

       •   дані слід виводити до звичайного файла (не на блоковий пристрій), і

       •   користувачем не використано параметр --size, і

       •   формат виведення є тим самим, що і формат шаблона (зазвичай raw).

       pxzcat

       Virt-builder використовує внутрішню реалізацію pxzcat (паралельного xzcat), якщо під час збирання програми було знайдено liblzma. Якщо liblzma не було знайдено під час збирання,
       використовуватиметься звичайний "xzcat", який працює у один потік.

   SELINUX
       Гостьові системи, у яких використовується SELinux (зокрема Fedora і Red Hat Enterprise Linux) потребують коректної мітки SELinux для кожного файла.

       Virt-builder не може знайти про спосіб, у який новим файлам надаються мітки. Тому існує дві можливі стратегії, використання яких забезпечує встановлення належних міток:

       Automatic relabeling
           Запуск setfiles(8) безпосередньо перед завершенням збирання образу гостьової системи для встановлення належних міток SELinux на образі диска.

           Це рекомендований метод.

       Using --no-selinux-relabel --touch /.autorelabel
           Наявність у гостьовій системі файла із назвою /.autorelabel або можливе його створення.

           У гостьових системах, де використовується SELinux, це спричиняє запуск restorecon(8) під час першого завантаження. Гостьові системи самостійно перезавантажуються під час першого використання —
           це нормальна і нешкідлива поведінка.

ПРИДАТНЕ ДО ЧИТАННЯ КОМП'ЮТЕРОМ ВИВЕДЕННЯ
       Для виведення даних у зручному для машинної обробки форматі можна скористатися параметром --machine-readable. Додавання цього параметра робить зручним використання virt-builder з інших програм,
       графічних інтерфейсів тощо.

       Скористайтеся цим параметром окремо, щоб опитати систему щодо можливостей виконуваного файла virt-builder.  Типово виведені дані виглядатимуть якось так:

        $ virt-builder --machine-readable
        virt-builder
        arch
        config-file
        customize
        json-list
        pxzcat

       Виводиться список можливостей, по одній на рядок, і програма завершує роботу зі станом 0.

       Можна вказати рядок форматування для керування виведенням, див. "РОЗШИРЕНЕ ПРИДАТНЕ ДО ЧИТАННЯ КОМП'ЮТЕРОМ ВИВЕДЕННЯ" in guestfs(3).

ЗМІННІ СЕРЕДОВИЩА
       Опис інших змінних середовища, які стосуються усіх програм libguestfs, наведено у розділі "ЗМІННІ СЕРЕДОВИЩА" in guestfs(3).

       "http_proxy"
       "https_proxy"
       "no_proxy"
           Встановити проксі-сервер для отримання даних. Ці змінні середовища (та інші) насправді обробляються curl(1), а не virt-builder.

       "HOME"
           Використовується для визначення місця кешу шаблонів та місця джерел користувача. Див. "КЕШУВАННЯ" і "ДЖЕРЕЛА ШАБЛОНІВ".

       "VIRT_TOOLS_DATA_DIR"
           Ця змінна визначає каталог, у якому містяться файли даних, які використовуються для встановлення Windows з першим завантаженням.

           Зазвичай, потреби у встановленні власного значення немає. Якщо значення не встановлено, буде використано вбудоване типове значення (щось схоже на /usr/share/virt-tools).

           Цей каталог може містити такі файли:

           rhsrvany.exe
               Це виконуваний файл для Windows RHSrvAny, який використовується для встановлення скрипту «firstboot» у гостьові системи Windows. Він знадобиться, якщо ви маєте намір використовувати
               параметри --firstboot і --firstboot-command для гостьових операційних систем Windows.

               Див. також "https://github.com/rwmjones/rhsrvany"

           pvvxsvc.exe
               Це виконуваний файл Windows, що постачається разом із VMDP SUSE, використовується для встановлення скрипту «firstboot» у гостьові системи Windows. Він знадобиться, якщо ви маєте намір
               використовувати параметри --firstboot і --firstboot-command для гостьових операційних систем Windows.

       "XDG_CACHE_HOME"
           Використовується для визначення місця кешу шаблонів. Див. "КЕШУВАННЯ".

       "XDG_CONFIG_HOME"
           Використовується для визначення місця джерел користувача. Див. "ДЖЕРЕЛА ШАБЛОНІВ".

       "VIRT_BUILDER_DIRS"
           Використовується для визначення місця джерел системи. Див. "ДЖЕРЕЛА ШАБЛОНІВ".

СТАН ВИХОДУ
       Ця програма повертає значення 0 у разі успішного завершення і ненульове значення, якщо сталася помилка.

ТАКОЖ ПЕРЕГЛЯНЬТЕ
       guestfs(3), guestfish(1), guestmount(1), virt-builder-repository(1), virt-copy-out(1), virt-customize(1), virt-get-kernel(1), virt-install(1), virt-rescue(1), virt-resize(1), virt-sysprep(1),
       oz-install(1), gpg(1), gpg2(1), curl(1), virt-make-fs(1), genisoimage(1), http://libguestfs.org/.

АВТОР
       Richard W.M. Jones http://people.redhat.com/~rjones/

АВТОРСЬКІ ПРАВА
       © Red Hat Inc., 2013

LICENSE
       This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the
       License, or (at your option) any later version.

       This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
       General Public License for more details.

       You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
       02110-1301 USA.

BUGS
       To get a list of bugs against libguestfs, use this link: https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&product=Virtualization+Tools

       To report a new bug against libguestfs, use this link: https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&product=Virtualization+Tools

       When reporting a bug, please supply:

       •   The version of libguestfs.

       •   Where you got libguestfs (eg. which Linux distro, compiled from source, etc)

       •   Describe the bug accurately and give a way to reproduce it.

       •   Run libguestfs-test-tool(1) and paste the complete, unedited output into the bug report.

guestfs-tools-1.52.3                                                                             2025-02-18                                                                                 virt-builder(1)
