VISIR_OLD_IMG_COMBINE(7)                                                                     visir recipes                                                                    VISIR_OLD_IMG_COMBINE(7)

NAME
       visir_old_img_combine - Old DRS detector: Images combination recipe

SYNOPSIS
       esorex visir_old_img_combine [OPTIONS] FILE.sof

DESCRIPTION
       This recipe recombines the data observed in chopping/nodding or chopping or nodding modes into one combined image using optionally cross-correlation methods.

       The  files  listed  in the Set Of Frames (sof-file) must be tagged: VISIR-observation-file.fits IM_OBS_CHO_NOD_JIT or VISIR-observation-file.fits IM_OBS_CHO_JIT or VISIR-observation-file.fits
       IM_OBS_NOD_JIT or VISIR-observation-file.fits IM_OBS_DIR_JIT

       The corresponding primary product will have a FITS card ´HIERARCH ESO PRO CATG´ with a value of IMG_OBS_COMBINED_CNJ or IMG_OBS_COMBINED_CJ or IMG_OBS_COMBINED_NJ or  IMG_OBS_COMBINED_DJ  and
       the corresponding beam-collapsed product will have a FITS card ´HIERARCH ESO PRO CATG´ with a value of IMG_OBS_ONEBEAM_CNJ or IMG_OBS_ONEBEAM_CJ or IMG_OBS_ONEBEAM_NJ or IMG_OBS_ONEBEAM_DJ

       Additionally, a bad pixel map with a PRO.CATG of IMG_BPM may be added to the Set Of Frames with tag: BPM.

OPTIONS
       --nod <str>
              An optional ASCII specification of the nodding positions (in case they are missing from the FITS-file). The file must consist of one line per input FITS-file and each line must consist
              of  an  integer  (which  is  ignored)  followed  by  a  0  or  1 (to indicate object or sky).  (str; default: ´NONE´). The full name of this option for the EsoRex configuration file is
              visir.visir_old_img_combine.nodding [default = NONE].

       --auto_bpm <bool>
              Automatic detection and correction of bad pixels (bool; default: True). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.auto_bpm  [default
              = True].

       --g <bool>
              Automatic filtering of glitches (bool; default: False). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.rem_glitch [default = False].

       --p <bool>
              Automatic purging of half-cycle images whose median deviates more than a factor three from the mean of the medians of half-cycle images or whose standard deviation deviates more than a
              factor  three from the mean of their standard deviations (bool; default: False). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.purge_bad
              [default = False].

       --union <bool>
              Combine images using their union, as opposed to their intersection (deprecated and ignored, see --combine_method) (bool; default: True). The full name of this  option  for  the  EsoRex
              configuration file is visir.visir_old_img_combine.union [default = True].

       --rej <str>
              Each  resulting  pixel is the average of the corresponding (interpolated) pixel value in each jittered image. A positive value, n1, for the first of the two integers specifies that for
              each pixel the smallest n1 pixel values shall be ignored in the averaging.  Similarly, a positive value, n2, for the second of the two  integers  specifies  that  for  each  pixel  the
              largest n2 pixel values shall be ignored in the averaging. (str; default: ´0-0´). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.rej [de‐
              fault = 0-0].

       --plot <int>
              The  recipe  can  produce a number of predefined plots. Zero means that none of the plots are produced, while increasing values (e.g. 1 or 2) increases the number of plots produced. If
              the plotting fails a warning is produced, and the recipe continues. The default behaviour of the plotting is to use gnuplot  (with  option  -persist).  The  recipe  currently  produces
              1D-plots  using  gnuplot  commands.  The recipe user can control the actual plotting-command used by the recipe to create the plot by setting the environment variable CPL_PLOTTER. Cur‐
              rently, if CPL_PLOTTER is set it must contain the string ´gnuplot´. Setting it to ´cat > my_gnuplot_$$.txt´ causes a number of ASCII-files to be created, which each produce a plot when
              given as standard input to gnuplot (e.g. later or on a different computer). A finer control of the plotting options can be obtained by writing an executable script, e.g. my_gnuplot.pl,
              that executes gnuplot after setting the desired gnuplot options (e.g. set terminal pslatex color) and then setting CPL_PLOTTER to my_gnuplot.pl. The predefined plots  include  plotting
              of  images.  Images  can  be plotted not only with gnuplot, but also using the pnm format. This is controlled with the environment variable CPL_IMAGER. If CPL_IMAGER is set to a string
              that does not contain the word gnuplot, the recipe will generate the plot in pnm format. E.g.  setting CPL_IMAGER to ´display - &´ will produce  a  gray-scale  image  using  the  image
              viewer display. (int; default: 0). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.plot [default = 0].

       --off <str>
              An  optional  ASCII specification of the offsets in case those in FITS- headers are missing or wrong. The file must consist of one line per input pair of FITS-files, and each line must
              consist of two numbers which represent the shift in pixels of that image relative to the first image. The first line should thus comprise two zeros. Correct  FITS-header  offsets  mean
              that  the  i´th  X offset can be gotten from Xoffset_0 - Xoffset_i, where Xoffset_i is the value of ESO SEQ CUMOFFSETX and likewise for Y. (str; default: ´NONE´). The full name of this
              option for the EsoRex configuration file is visir.visir_old_img_combine.offsets [default = NONE].

       --ref <bool>
              User-defined refining  of  the  image  offsets.  See  options  objs  and  xcorr  (bool;  default:  False).  The  full  name  of  this  option  for  the  EsoRex  configuration  file  is
              visir.visir_old_img_combine.refine [default = False].

       --objs <str>
              The  shift  and  add  of images needs anchor points that typically are bright objects. These are normally detected automatically but with user-defined refining of offsets enabled, they
              must be provided by the user through an ASCII file containing one line per anchor point with each line consisting of its x and y coordinate (in  pixels).  This  file  is  ignored  with
              user-defined  refining  of  offsets  disabled.  (str; default: ´NONE´). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.objects [default =
              NONE].

       --xcorr <str>
              If user-defined refining of offsets is enabled a cross-correlation of the images is performed. In order to speed up this process, this cross-correlation is performed  only  on  smaller
              rectangles  around  the  anchor points. The first two parameters is the half-size of this rectangle in pixels. The second pair is the maximum shift in x and y (pixels) evaluated by the
              cross-correlation on the rectangle. Used only if user-defined refining of offsets is enabled. (str; default: ´10-10-25-25´). The full name of this option for the  EsoRex  configuration
              file is visir.visir_old_img_combine.xcorr [default = 10-10-25-25].

       --combine_method <str>
              Combine  images using one of: 1) Onto the first image (first); 2) Their union (union); 3) Their intersection (inter). NB: Only the ´first´-method produces an image product with WCS co‐
              ordinates. A successful ´first´-method always produces a combined image with dimensions equal to those of the input images. For the ´union´-method the result image is at least as large
              as the input images while for the ´inter´-method the result image is at most as large as the input images (str; default: ´union´). The full name of this option for the EsoRex  configu‐
              ration file is visir.visir_old_img_combine.comb_meth [default = union].

       --destripe_iterations <int>
              Max  number  of  destriping iterations (0 to disable destriping).  Horizontal destriping is done first and if no horizontal striping is detected, vertical destriping is performed (int;
              default: 15). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.nstripe [default = 15].

       --destripe_morpho <bool>
              Destripe with morphological cleaning (bool; default: False). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.mstripe [default = False].

       --eccmax <float>
              The maximum eccentricity allowed in the combination of the three (in parallel nod/chopping) or four (in perpendicular nod/chopping) beams.  In parallel mode,  three  perfectly  aligned
              points  spaced  with the chopnod throw will have eccentricity 0, while in perpedicular mode a square with the chopnod throw as the side length will have eccentricity 0 (float; default:
              0.25). The full name of this option for the EsoRex configuration file is visir.visir_old_img_combine.eccmax [default = 0.25].

       Note that it is possible to create a configuration file containing these options, along with suitable default values. Please refer to the details provided by the 'esorex --help' command.

SEE ALSO
       The full documentation for the visir pipeline can be downloaded as a PDF file using the following URL:

              ftp://ftp.eso.org/pub/dfs/pipelines/visir/visir-pipeline-manual-1.4.pdf

       An overview over the existing ESO pipelines can be found on the web page https://www.eso.org/sci/software/pipelines/.

       Basic documentation about the EsoRex program can be found at the esorex (1) man page.

       It is possible to call the pipelines from python using the python-cpl package.  See https://packages.python.org/python-cpl/index.html for further information.

       The other recipes of the visir pipeline are visir_img_dark(7), visir_img_ff(7), visir_img_reduce(7), visir_img_trans(7), visir_old_img_phot(7), visir_old_spc_obs(7), visir_old_spc_obs_ech(7),
       visir_old_spc_phot(7),   visir_old_spc_phot_ech(7),   visir_old_spc_wcal(7),    visir_old_spc_wcal_ech(7),    visir_old_util_destripe(7),    visir_spc_reduce(7),    visir_util_apply_calib(7),
       visir_util_clip(7),  visir_util_convert_weight(7),  visir_util_detect_shift(7), visir_util_img_std_cat(7), visir_util_join(7), visir_util_qc(7), visir_util_repack(7), visir_util_run_swarp(7),
       visir_util_spc_std_cat(7), visir_util_spc_txt2fits(7), visir_util_undistort(7)

VERSION
       visir_old_img_combine 4.4.2

AUTHOR
       Lars Lundin <https://support.eso.org>

BUG REPORTS
       Please report any problems to https://support.eso.org. Alternatively, you may send a report to the ESO User Support Department <usd-help@eso.org>.

LICENSE
       This file is part of the VISIR Instrument Pipeline Copyright (C) 2004, 2005 European Southern Observatory

       This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the
       License, or (at your option) any later version.

       This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE.   See  the
       GNU General Public License for more details.

       You  should  have  received  a  copy  of  the  GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
       02111-1307  USA

visir_old_img_combine                                                                            4.4.2                                                                        VISIR_OLD_IMG_COMBINE(7)
