MK-SLAVE-DELAY(1)                                                                     User Contributed Perl Documentation                                                                     MK-SLAVE-DELAY(1)

NAME
       mk-slave-delay - Make a MySQL slave server lag behind its master.

SYNOPSIS
       Usage: mk-slave-delay [OPTION...] SLAVE-HOST [MASTER-HOST]

       mk-slave-delay starts and stops a slave server as needed to make it lag behind the master.  The SLAVE-HOST and MASTER-HOST use DSN syntax, and values are copied from the SLAVE-HOST to the MASTER-HOST
       if omitted.

       To hold slavehost one minute behind its master for ten minutes:

          mk-slave-delay --delay 1m --interval 15s --run-time 10m slavehost

RISKS
       The following section is included to inform users about the potential risks, whether known or unknown, of using this tool.  The two main categories of risks are those created by the nature of the tool
       (e.g. read-only tools vs. read-write tools) and those created by bugs.

       mk-slave-delay is generally very low-risk.  It simply starts and stops the replication SQL thread.  This might cause monitoring systems to think the slave is having trouble.

       At the time of this release, we know of no bugs that could cause serious harm to users.

       The authoritative source for updated information is always the online issue tracking system.  Issues that affect this tool will be marked as such.  You can see a list of such issues at the following
       URL: <http://www.maatkit.org/bugs/mk-slave-delay>.

       See also "BUGS" for more information on filing bugs and getting help.

DESCRIPTION
       "mk-slave-delay" watches a slave and starts and stops its replication SQL thread as necessary to hold it at least as far behind the master as you request.  In practice, it will typically cause the
       slave to lag between "--delay" and "--delay"+"--interval" behind the master.

       It bases the delay on binlog positions in the slave's relay logs by default, so there is no need to connect to the master.  This works well if the IO thread doesn't lag the master much, which is
       typical in most replication setups; the IO thread lag is usually milliseconds on a fast network.  If your IO thread's lag is too large for your purposes, "mk-slave-delay" can also connect to the
       master for information about binlog positions.

       If the slave's I/O thread reports that it is waiting for the SQL thread to free some relay log space, "mk-slave-delay" will automatically connect to the master to find binary log positions.  If
       "--ask-pass" and "--daemonize" are given, it is possible that this could cause it to ask for a password while daemonized.  In this case, it exits.  Therefore, if you think your slave might encounter
       this condition, you should be sure to either specify "--use-master" explicitly when daemonizing, or don't specify "--ask-pass".

       The SLAVE-HOST and optional MASTER-HOST are both DSNs.  See "DSN OPTIONS".  Missing MASTER-HOST values are filled in with values from SLAVE-HOST, so you don't need to specify them in both places.
       "mk-slave-delay" reads all normal MySQL option files, such as ~/.my.cnf, so you may not need to specify username, password and other common options at all.

       "mk-slave-delay" tries to exit gracefully by trapping signals such as Ctrl-C.  You cannot bypass "--[no]continue" with a trappable signal.

PRIVILEGES
       mk-slave-delay requires the following privileges: PROCESS, REPLICATION CLIENT, and SUPER.

OUTPUT
       If you specify "--quiet", there is no output.  Otherwise, the normal output is a status message consisting of a timestamp and information about what "mk-slave-delay" is doing: starting the slave,
       stopping the slave, or just observing.

OPTIONS
       This tool accepts additional command-line arguments.  Refer to the "SYNOPSIS" and usage information for details.

       --ask-pass
           Prompt for a password when connecting to MySQL.

       --charset
           short form: -A; type: string

           Default character set.  If the value is utf8, sets Perl's binmode on STDOUT to utf8, passes the mysql_enable_utf8 option to DBD::mysql, and runs SET NAMES UTF8 after connecting to MySQL.  Any
           other value sets binmode on STDOUT without the utf8 layer, and runs SET NAMES after connecting to MySQL.

       --config
           type: Array

           Read this comma-separated list of config files; if specified, this must be the first option on the command line.

       --[no]continue
           default: yes

           Continue replication normally on exit.  After exiting, restart the slave's SQL thread with no UNTIL condition, so it will run as usual and catch up to the master.  This is enabled by default and
           works even if you terminate "mk-slave-delay" with Control-C.

       --daemonize
           Fork to the background and detach from the shell.  POSIX operating systems only.

       --defaults-file
           short form: -F; type: string

           Only read mysql options from the given file.  You must give an absolute pathname.

       --delay
           type: time; default: 1h

           How far the slave should lag its master.

       --help
           Show help and exit.

       --host
           short form: -h; type: string

           Connect to host.

       --interval
           type: time; default: 1m

           How frequently "mk-slave-delay" should check whether the slave needs to be started or stopped.

       --log
           type: string

           Print all output to this file when daemonized.

       --password
           short form: -p; type: string

           Password to use when connecting.

       --pid
           type: string

           Create the given PID file when daemonized.  The file contains the process ID of the daemonized instance.  The PID file is removed when the daemonized instance exits.  The program checks for the
           existence of the PID file when starting; if it exists and the process with the matching PID exists, the program exits.

       --port
           short form: -P; type: int

           Port number to use for connection.

       --quiet
           short form: -q

           Don't print informational messages about operation.  See OUTPUT for details.

       --run-time
           type: time

           How long "mk-slave-delay" should run before exiting.  The default is to run forever.

       --set-vars
           type: string; default: wait_timeout=10000

           Set these MySQL variables.  Immediately after connecting to MySQL, this string will be appended to SET and executed.

       --socket
           short form: -S; type: string

           Socket file to use for connection.

       --use-master
           Get binlog positions from master, not slave.  Don't trust the binlog positions in the slave's relay log.  Connect to the master and get binlog positions instead.  If you specify this option
           without giving a MASTER-HOST on the command line, "mk-slave-delay" examines the slave's SHOW SLAVE STATUS to determine the hostname and port for connecting to the master.

           "mk-slave-delay" uses only the MASTER_HOST and MASTER_PORT values from SHOW SLAVE STATUS for the master connection.  It does not use the MASTER_USER value.  If you want to specify a different
           username for the master than the one you use to connect to the slave, you should specify the MASTER-HOST option explicitly on the command line.

       --user
           short form: -u; type: string

           User for login if not current user.

       --version
           Show version and exit.

DSN OPTIONS
       These DSN options are used to create a DSN.  Each option is given like "option=value".  The options are case-sensitive, so P and p are not the same option.  There cannot be whitespace before or after
       the "=" and if the value contains whitespace it must be quoted.  DSN options are comma-separated.  See the maatkit manpage for full details.

       •   A

           dsn: charset; copy: yes

           Default character set.

       •   D

           dsn: database; copy: yes

           Default database.

       •   F

           dsn: mysql_read_default_file; copy: yes

           Only read default options from the given file

       •   h

           dsn: host; copy: yes

           Connect to host.

       •   p

           dsn: password; copy: yes

           Password to use when connecting.

       •   P

           dsn: port; copy: yes

           Port number to use for connection.

       •   S

           dsn: mysql_socket; copy: yes

           Socket file to use for connection.

       •   u

           dsn: user; copy: yes

           User for login if not current user.

DOWNLOADING
       You can download Maatkit from Google Code at <http://code.google.com/p/maatkit/>, or you can get any of the tools easily with a command like the following:

          wget http://www.maatkit.org/get/toolname
          or
          wget http://www.maatkit.org/trunk/toolname

       Where "toolname" can be replaced with the name (or fragment of a name) of any of the Maatkit tools.  Once downloaded, they're ready to run; no installation is needed.  The first URL gets the latest
       released version of the tool, and the second gets the latest trunk code from Subversion.

ENVIRONMENT
       The environment variable "MKDEBUG" enables verbose debugging output in all of the Maatkit tools:

          MKDEBUG=1 mk-....

SYSTEM REQUIREMENTS
       You need Perl, DBI, DBD::mysql, and some core packages that ought to be installed in any reasonably new version of Perl.

BUGS
       For a list of known bugs see <http://www.maatkit.org/bugs/mk-slave-delay>.

       Please use Google Code Issues and Groups to report bugs or request support: <http://code.google.com/p/maatkit/>.  You can also join #maatkit on Freenode to discuss Maatkit.

       Please include the complete command-line used to reproduce the problem you are seeing, the version of all MySQL servers involved, the complete output of the tool when run with "--version", and if
       possible, debugging output produced by running with the "MKDEBUG=1" environment variable.

COPYRIGHT, LICENSE AND WARRANTY
       This program is copyright 2007-2011 Sergey Zhuravlev and Baron Schwartz.  Feedback and improvements are welcome.

       THIS PROGRAM IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.

       This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, version 2; OR the Perl Artistic
       License.  On UNIX and similar systems, you can issue `man perlgpl' or `man perlartistic' to read these licenses.

       You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA.

AUTHOR
       Sergey Zhuravlev, Baron Schwartz

ABOUT MAATKIT
       This tool is part of Maatkit, a toolkit for power users of MySQL.  Maatkit was created by Baron Schwartz; Baron and Daniel Nichter are the primary code contributors.  Both are employed by Percona.
       Financial support for Maatkit development is primarily provided by Percona and its clients.

VERSION
       This manual page documents Ver 1.0.23 Distrib 7540 $Revision: 7477 $.

perl v5.34.0                                                                                       2021-07-22                                                                                 MK-SLAVE-DELAY(1)
