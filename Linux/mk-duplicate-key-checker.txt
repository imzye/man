MK-DUPLICATE-KEY-CHECKER(1)                                                           User Contributed Perl Documentation                                                           MK-DUPLICATE-KEY-CHECKER(1)

NAME
       mk-duplicate-key-checker - Find duplicate indexes and foreign keys on MySQL tables.

SYNOPSIS
       Usage: mk-duplicate-key-checker [OPTION...] [DSN]

       mk-duplicate-key-checker examines MySQL tables for duplicate or redundant indexes and foreign keys.  Connection options are read from MySQL option files.

          mk-duplicate-key-checker --host host1

RISKS
       The following section is included to inform users about the potential risks, whether known or unknown, of using this tool.  The two main categories of risks are those created by the nature of the tool
       (e.g. read-only tools vs. read-write tools) and those created by bugs.

       mk-duplicate-key-checker is a read-only tool that executes SHOW CREATE TABLE and related queries to inspect table structures, and thus is very low-risk.

       At the time of this release, there is an unconfirmed bug that causes the tool to crash.

       The authoritative source for updated information is always the online issue tracking system.  Issues that affect this tool will be marked as such.  You can see a list of such issues at the following
       URL: <http://www.maatkit.org/bugs/mk-duplicate-key-checker>.

       See also "BUGS" for more information on filing bugs and getting help.

DESCRIPTION
       This program examines the output of SHOW CREATE TABLE on MySQL tables, and if it finds indexes that cover the same columns as another index in the same order, or cover an exact leftmost prefix of
       another index, it prints out the suspicious indexes.  By default, indexes must be of the same type, so a BTREE index is not a duplicate of a FULLTEXT index, even if they have the same columns.  You
       can override this.

       It also looks for duplicate foreign keys.  A duplicate foreign key covers the same columns as another in the same table, and references the same parent table.

OPTIONS
       This tool accepts additional command-line arguments.  Refer to the "SYNOPSIS" and usage information for details.

       --all-structs
           Compare indexes with different structs (BTREE, HASH, etc).

           By default this is disabled, because a BTREE index that covers the same columns as a FULLTEXT index is not really a duplicate, for example.

       --ask-pass
           Prompt for a password when connecting to MySQL.

       --charset
           short form: -A; type: string

           Default character set.  If the value is utf8, sets Perl's binmode on STDOUT to utf8, passes the mysql_enable_utf8 option to DBD::mysql, and runs SET NAMES UTF8 after connecting to MySQL.  Any
           other value sets binmode on STDOUT without the utf8 layer, and runs SET NAMES after connecting to MySQL.

       --[no]clustered
           default: yes

           PK columns appended to secondary key is duplicate.

           Detects when a suffix of a secondary key is a leftmost prefix of the primary key, and treats it as a duplicate key.  Only detects this condition on storage engines whose primary keys are clustered
           (currently InnoDB and solidDB).

           Clustered storage engines append the primary key columns to the leaf nodes of all secondary keys anyway, so you might consider it redundant to have them appear in the internal nodes as well.  Of
           course, you may also want them in the internal nodes, because just having them at the leaf nodes won't help for some queries.  It does help for covering index queries, however.

           Here's an example of a key that is considered redundant with this option:

             PRIMARY KEY  (`a`)
             KEY `b` (`b`,`a`)

           The use of such indexes is rather subtle.  For example, suppose you have the following query:

             SELECT ... WHERE b=1 ORDER BY a;

           This query will do a filesort if we remove the index on "b,a".  But if we shorten the index on "b,a" to just "b" and also remove the ORDER BY, the query should return the same results.

           The tool suggests shortening duplicate clustered keys by dropping the key and re-adding it without the primary key prefix.  The shortened clustered key may still duplicate another key, but the
           tool cannot currently detect when this happens without being ran a second time to re-check the newly shortened clustered keys.  Therefore, if you shorten any duplicate clustered keys, you should
           run the tool again.

       --config
           type: Array

           Read this comma-separated list of config files; if specified, this must be the first option on the command line.

       --databases
           short form: -d; type: hash

           Check only this comma-separated list of databases.

       --defaults-file
           short form: -F; type: string

           Only read mysql options from the given file.  You must give an absolute pathname.

       --engines
           short form: -e; type: hash

           Check only tables whose storage engine is in this comma-separated list.

       --help
           Show help and exit.

       --host
           short form: -h; type: string

           Connect to host.

       --ignore-databases
           type: Hash

           Ignore this comma-separated list of databases.

       --ignore-engines
           type: Hash

           Ignore this comma-separated list of storage engines.

       --ignore-order
           Ignore index order so KEY(a,b) duplicates KEY(b,a).

       --ignore-tables
           type: Hash

           Ignore this comma-separated list of tables.  Table names may be qualified with the database name.

       --key-types
           type: string; default: fk

           Check for duplicate f=foreign keys, k=keys or fk=both.

       --password
           short form: -p; type: string

           Password to use when connecting.

       --pid
           type: string

           Create the given PID file.  The file contains the process ID of the script.  The PID file is removed when the script exits.  Before starting, the script checks if the PID file already exists.  If
           it does not, then the script creates and writes its own PID to it.  If it does, then the script checks the following: if the file contains a PID and a process is running with that PID, then the
           script dies; or, if there is no process running with that PID, then the script overwrites the file with its own PID and starts; else, if the file contains no PID, then the script dies.

       --port
           short form: -P; type: int

           Port number to use for connection.

       --set-vars
           type: string; default: wait_timeout=10000

           Set these MySQL variables.  Immediately after connecting to MySQL, this string will be appended to SET and executed.

       --socket
           short form: -S; type: string

           Socket file to use for connection.

       --[no]sql
           default: yes

           Print DROP KEY statement for each duplicate key.  By default an ALTER TABLE DROP KEY statement is printed below each duplicate key so that, if you want to remove the duplicate key, you can copy-
           paste the statement into MySQL.

           To disable printing these statements, specify --nosql.

       --[no]summary
           default: yes

           Print summary of indexes at end of output.

       --tables
           short form: -t; type: hash

           Check only this comma-separated list of tables.

           Table names may be qualified with the database name.

       --user
           short form: -u; type: string

           User for login if not current user.

       --verbose
           short form: -v

           Output all keys and/or foreign keys found, not just redundant ones.

       --version
           Show version and exit.

DSN OPTIONS
       These DSN options are used to create a DSN.  Each option is given like "option=value".  The options are case-sensitive, so P and p are not the same option.  There cannot be whitespace before or after
       the "=" and if the value contains whitespace it must be quoted.  DSN options are comma-separated.  See the maatkit manpage for full details.

       •   A

           dsn: charset; copy: yes

           Default character set.

       •   D

           dsn: database; copy: yes

           Default database.

       •   F

           dsn: mysql_read_default_file; copy: yes

           Only read default options from the given file

       •   h

           dsn: host; copy: yes

           Connect to host.

       •   p

           dsn: password; copy: yes

           Password to use when connecting.

       •   P

           dsn: port; copy: yes

           Port number to use for connection.

       •   S

           dsn: mysql_socket; copy: yes

           Socket file to use for connection.

       •   u

           dsn: user; copy: yes

           User for login if not current user.

DOWNLOADING
       You can download Maatkit from Google Code at <http://code.google.com/p/maatkit/>, or you can get any of the tools easily with a command like the following:

          wget http://www.maatkit.org/get/toolname
          or
          wget http://www.maatkit.org/trunk/toolname

       Where "toolname" can be replaced with the name (or fragment of a name) of any of the Maatkit tools.  Once downloaded, they're ready to run; no installation is needed.  The first URL gets the latest
       released version of the tool, and the second gets the latest trunk code from Subversion.

ENVIRONMENT
       The environment variable "MKDEBUG" enables verbose debugging output in all of the Maatkit tools:

          MKDEBUG=1 mk-....

SYSTEM REQUIREMENTS
       You need the following Perl modules: DBI and DBD::mysql.

BUGS
       For a list of known bugs see <http://www.maatkit.org/bugs/mk-duplicate-key-checker>.

       Please use Google Code Issues and Groups to report bugs or request support: <http://code.google.com/p/maatkit/>.  You can also join #maatkit on Freenode to discuss Maatkit.

       Please include the complete command-line used to reproduce the problem you are seeing, the version of all MySQL servers involved, the complete output of the tool when run with "--version", and if
       possible, debugging output produced by running with the "MKDEBUG=1" environment variable.

COPYRIGHT, LICENSE AND WARRANTY
       This program is copyright 2007-2011 Baron Schwartz.  Feedback and improvements are welcome.

       THIS PROGRAM IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.

       This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, version 2; OR the Perl Artistic
       License.  On UNIX and similar systems, you can issue `man perlgpl' or `man perlartistic' to read these licenses.

       You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA.

AUTHOR
       Baron Schwartz, Daniel Nichter

ABOUT MAATKIT
       This tool is part of Maatkit, a toolkit for power users of MySQL.  Maatkit was created by Baron Schwartz; Baron and Daniel Nichter are the primary code contributors.  Both are employed by Percona.
       Financial support for Maatkit development is primarily provided by Percona and its clients.

VERSION
       This manual page documents Ver 1.2.15 Distrib 7540 $Revision: 7477 $.

perl v5.34.0                                                                                       2021-07-22                                                                       MK-DUPLICATE-KEY-CHECKER(1)
